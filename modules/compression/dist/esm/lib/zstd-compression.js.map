{"version":3,"file":"zstd-compression.js","names":["Compression","ZstdCodec","zstd","ZstdCompression","constructor","options","_this$options","_this$options$modules","_defineProperty","modules","console","warn","concat","name","preload","Promise","resolve","run","compressSync","input","simpleZstd","Simple","inputArray","Uint8Array","compress","buffer","decompressSync","decompress"],"sources":["../../../src/lib/zstd-compression.ts"],"sourcesContent":["// ZSTD\nimport type {CompressionOptions} from './compression';\nimport {Compression} from './compression';\n// import {ZstdCodec} from 'zstd-codec'; // https://bundlephobia.com/package/zstd-codec\n\nlet ZstdCodec;\nlet zstd;\n\n/**\n * Zstandard compression / decompression\n */\nexport class ZstdCompression extends Compression {\n  readonly name: string = 'zstd';\n  readonly extensions = [];\n  readonly contentEncodings = [];\n  readonly isSupported = true;\n  readonly options: CompressionOptions;\n\n  /**\n   * zstd-codec is an injectable dependency due to big size\n   * @param options\n   */\n  constructor(options: CompressionOptions) {\n    super(options);\n    this.options = options;\n\n    ZstdCodec = this.options?.modules?.['zstd-codec'];\n    if (!ZstdCodec) {\n      // eslint-disable-next-line no-console\n      console.warn(`${this.name} library not installed`);\n    }\n  }\n\n  async preload(): Promise<void> {\n    if (!zstd && ZstdCodec) {\n      zstd = await new Promise((resolve) => ZstdCodec.run((zstd) => resolve(zstd)));\n    }\n  }\n\n  compressSync(input: ArrayBuffer): ArrayBuffer {\n    const simpleZstd = new zstd.Simple();\n    const inputArray = new Uint8Array(input);\n    return simpleZstd.compress(inputArray).buffer;\n  }\n\n  decompressSync(input: ArrayBuffer): ArrayBuffer {\n    const simpleZstd = new zstd.Simple();\n    // var ddict = new zstd.Dict.Decompression(dictData);\n    // var jsonBytes = simpleZstd.decompressUsingDict(jsonZstData, ddict);\n    const inputArray = new Uint8Array(input);\n    return simpleZstd.decompress(inputArray).buffer;\n  }\n}\n"],"mappings":";AAEA,SAAQA,WAAW,QAAO,eAAe;AAGzC,IAAIC,SAAS;AACb,IAAIC,IAAI;AAKR,OAAO,MAAMC,eAAe,SAASH,WAAW,CAAC;EAW/CI,WAAWA,CAACC,OAA2B,EAAE;IAAA,IAAAC,aAAA,EAAAC,qBAAA;IACvC,KAAK,CAACF,OAAO,CAAC;IAACG,eAAA,eAXO,MAAM;IAAAA,eAAA,qBACR,EAAE;IAAAA,eAAA,2BACI,EAAE;IAAAA,eAAA,sBACP,IAAI;IAAAA,eAAA;IASzB,IAAI,CAACH,OAAO,GAAGA,OAAO;IAEtBJ,SAAS,IAAAK,aAAA,GAAG,IAAI,CAACD,OAAO,cAAAC,aAAA,wBAAAC,qBAAA,GAAZD,aAAA,CAAcG,OAAO,cAAAF,qBAAA,uBAArBA,qBAAA,CAAwB,YAAY,CAAC;IACjD,IAAI,CAACN,SAAS,EAAE;MAEdS,OAAO,CAACC,IAAI,IAAAC,MAAA,CAAI,IAAI,CAACC,IAAI,2BAAwB,CAAC;IACpD;EACF;EAEA,MAAMC,OAAOA,CAAA,EAAkB;IAC7B,IAAI,CAACZ,IAAI,IAAID,SAAS,EAAE;MACtBC,IAAI,GAAG,MAAM,IAAIa,OAAO,CAAEC,OAAO,IAAKf,SAAS,CAACgB,GAAG,CAAEf,IAAI,IAAKc,OAAO,CAACd,IAAI,CAAC,CAAC,CAAC;IAC/E;EACF;EAEAgB,YAAYA,CAACC,KAAkB,EAAe;IAC5C,MAAMC,UAAU,GAAG,IAAIlB,IAAI,CAACmB,MAAM,CAAC,CAAC;IACpC,MAAMC,UAAU,GAAG,IAAIC,UAAU,CAACJ,KAAK,CAAC;IACxC,OAAOC,UAAU,CAACI,QAAQ,CAACF,UAAU,CAAC,CAACG,MAAM;EAC/C;EAEAC,cAAcA,CAACP,KAAkB,EAAe;IAC9C,MAAMC,UAAU,GAAG,IAAIlB,IAAI,CAACmB,MAAM,CAAC,CAAC;IAGpC,MAAMC,UAAU,GAAG,IAAIC,UAAU,CAACJ,KAAK,CAAC;IACxC,OAAOC,UAAU,CAACO,UAAU,CAACL,UAAU,CAAC,CAACG,MAAM;EACjD;AACF"}