{"version":3,"file":"worker.js","names":["createWorker","NoCompression","BrotliCompression","DeflateCompression","GZipCompression","LZ4Compression","SnappyCompression","ZstdCompression","lz4js","modules","COMPRESSIONS","data","options","arguments","length","undefined","operation","getOperation","String","compression","getCompression","compress","decompress","Error","concat","name","Compression","find","compression_"],"sources":["../../../src/workers/worker.ts"],"sourcesContent":["import {createWorker} from '@loaders.gl/worker-utils';\n\n// Compressors\nimport {NoCompression} from '../lib/no-compression';\nimport {BrotliCompression} from '../lib/brotli-compression';\nimport {DeflateCompression} from '../lib/deflate-compression';\nimport {GZipCompression} from '../lib/gzip-compression';\nimport {LZ4Compression} from '../lib/lz4-compression';\n// import {LZOCompression} from '../lib/lzo-compression';\nimport {SnappyCompression} from '../lib/snappy-compression';\nimport {ZstdCompression} from '../lib/zstd-compression';\n\n// Import big dependencies\n\n// import brotli from 'brotli'; - brotli has problems with decompress in browsers\n// import brotliDecompress from 'brotli/decompress';\nimport lz4js from 'lz4js';\n// import lzo from 'lzo';\n// import {ZstdCodec} from 'zstd-codec';\n\n// Inject large dependencies through Compression constructor options\nconst modules = {\n  // brotli has problems with decompress in browsers\n  // brotli: {\n  //   decompress: brotliDecompress,\n  //   compress: () => {\n  //     throw new Error('brotli compress');\n  //   }\n  // },\n  lz4js\n  // lzo,\n  // 'zstd-codec': ZstdCodec\n};\n\n/** @type {Compression[]} */\nconst COMPRESSIONS = [\n  new NoCompression({modules}),\n  new BrotliCompression({modules}),\n  new DeflateCompression({modules}),\n  new GZipCompression({modules}),\n  // new LZOCompression({modules}),\n  new LZ4Compression({modules}),\n  new SnappyCompression({modules}),\n  new ZstdCompression({modules})\n];\n\ncreateWorker(async (data, options = {}) => {\n  const operation = getOperation(String(options?.operation));\n  const compression = getCompression(String(options?.compression));\n\n  // @ts-ignore\n  switch (operation) {\n    case 'compress':\n      return await compression.compress(data);\n    case 'decompress':\n      return await compression.decompress(data);\n    default:\n      throw new Error('invalid option');\n  }\n});\n\nfunction getOperation(operation: string): 'compress' | 'decompress' {\n  switch (operation) {\n    case 'compress':\n    case 'deflate':\n      return 'compress';\n    case 'decompress':\n    case 'inflate':\n      return 'decompress';\n    default:\n      throw new Error(\n        `@loaders.gl/compression: Unsupported operation ${operation}. Expected 'compress' or 'decompress'`\n      );\n  }\n}\n\nfunction getCompression(name: string) {\n  const Compression = COMPRESSIONS.find((compression_) => name === compression_.name);\n  if (!Compression) {\n    throw new Error(`@loaders.gl/compression: Unsupported compression ${name}`);\n  }\n  return Compression;\n}\n"],"mappings":"AAAA,SAAQA,YAAY,QAAO,0BAA0B;AAGrD,SAAQC,aAAa,QAAO,uBAAuB;AACnD,SAAQC,iBAAiB,QAAO,2BAA2B;AAC3D,SAAQC,kBAAkB,QAAO,4BAA4B;AAC7D,SAAQC,eAAe,QAAO,yBAAyB;AACvD,SAAQC,cAAc,QAAO,wBAAwB;AAErD,SAAQC,iBAAiB,QAAO,2BAA2B;AAC3D,SAAQC,eAAe,QAAO,yBAAyB;AAMvD,OAAOC,KAAK,MAAM,OAAO;AAKzB,MAAMC,OAAO,GAAG;EAQdD;AAGF,CAAC;AAGD,MAAME,YAAY,GAAG,CACnB,IAAIT,aAAa,CAAC;EAACQ;AAAO,CAAC,CAAC,EAC5B,IAAIP,iBAAiB,CAAC;EAACO;AAAO,CAAC,CAAC,EAChC,IAAIN,kBAAkB,CAAC;EAACM;AAAO,CAAC,CAAC,EACjC,IAAIL,eAAe,CAAC;EAACK;AAAO,CAAC,CAAC,EAE9B,IAAIJ,cAAc,CAAC;EAACI;AAAO,CAAC,CAAC,EAC7B,IAAIH,iBAAiB,CAAC;EAACG;AAAO,CAAC,CAAC,EAChC,IAAIF,eAAe,CAAC;EAACE;AAAO,CAAC,CAAC,CAC/B;AAEDT,YAAY,CAAC,gBAAOW,IAAI,EAAmB;EAAA,IAAjBC,OAAO,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,CAAC,CAAC;EACpC,MAAMG,SAAS,GAAGC,YAAY,CAACC,MAAM,CAACN,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEI,SAAS,CAAC,CAAC;EAC1D,MAAMG,WAAW,GAAGC,cAAc,CAACF,MAAM,CAACN,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEO,WAAW,CAAC,CAAC;EAGhE,QAAQH,SAAS;IACf,KAAK,UAAU;MACb,OAAO,MAAMG,WAAW,CAACE,QAAQ,CAACV,IAAI,CAAC;IACzC,KAAK,YAAY;MACf,OAAO,MAAMQ,WAAW,CAACG,UAAU,CAACX,IAAI,CAAC;IAC3C;MACE,MAAM,IAAIY,KAAK,CAAC,gBAAgB,CAAC;EACrC;AACF,CAAC,CAAC;AAEF,SAASN,YAAYA,CAACD,SAAiB,EAA6B;EAClE,QAAQA,SAAS;IACf,KAAK,UAAU;IACf,KAAK,SAAS;MACZ,OAAO,UAAU;IACnB,KAAK,YAAY;IACjB,KAAK,SAAS;MACZ,OAAO,YAAY;IACrB;MACE,MAAM,IAAIO,KAAK,mDAAAC,MAAA,CACqCR,SAAS,0CAC7D,CAAC;EACL;AACF;AAEA,SAASI,cAAcA,CAACK,IAAY,EAAE;EACpC,MAAMC,WAAW,GAAGhB,YAAY,CAACiB,IAAI,CAAEC,YAAY,IAAKH,IAAI,KAAKG,YAAY,CAACH,IAAI,CAAC;EACnF,IAAI,CAACC,WAAW,EAAE;IAChB,MAAM,IAAIH,KAAK,qDAAAC,MAAA,CAAqDC,IAAI,CAAE,CAAC;EAC7E;EACA,OAAOC,WAAW;AACpB"}