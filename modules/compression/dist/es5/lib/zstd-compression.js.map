{"version":3,"file":"zstd-compression.js","names":["_compression","require","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf2","default","result","NewTarget","constructor","Reflect","construct","arguments","apply","_possibleConstructorReturn2","sham","Proxy","Boolean","prototype","valueOf","call","e","ZstdCodec","zstd","ZstdCompression","_Compression","_inherits2","_super","options","_this$options","_this$options$modules","_this","_classCallCheck2","_defineProperty2","_assertThisInitialized2","modules","console","warn","concat","name","_createClass2","key","value","_preload","_asyncToGenerator2","_regenerator","mark","_callee","wrap","_callee$","_context","prev","next","Promise","resolve","run","sent","stop","preload","compressSync","input","simpleZstd","Simple","inputArray","Uint8Array","compress","buffer","decompressSync","decompress","Compression","exports"],"sources":["../../../src/lib/zstd-compression.ts"],"sourcesContent":["// ZSTD\nimport type {CompressionOptions} from './compression';\nimport {Compression} from './compression';\n// import {ZstdCodec} from 'zstd-codec'; // https://bundlephobia.com/package/zstd-codec\n\nlet ZstdCodec;\nlet zstd;\n\n/**\n * Zstandard compression / decompression\n */\nexport class ZstdCompression extends Compression {\n  readonly name: string = 'zstd';\n  readonly extensions = [];\n  readonly contentEncodings = [];\n  readonly isSupported = true;\n  readonly options: CompressionOptions;\n\n  /**\n   * zstd-codec is an injectable dependency due to big size\n   * @param options\n   */\n  constructor(options: CompressionOptions) {\n    super(options);\n    this.options = options;\n\n    ZstdCodec = this.options?.modules?.['zstd-codec'];\n    if (!ZstdCodec) {\n      // eslint-disable-next-line no-console\n      console.warn(`${this.name} library not installed`);\n    }\n  }\n\n  async preload(): Promise<void> {\n    if (!zstd && ZstdCodec) {\n      zstd = await new Promise((resolve) => ZstdCodec.run((zstd) => resolve(zstd)));\n    }\n  }\n\n  compressSync(input: ArrayBuffer): ArrayBuffer {\n    const simpleZstd = new zstd.Simple();\n    const inputArray = new Uint8Array(input);\n    return simpleZstd.compress(inputArray).buffer;\n  }\n\n  decompressSync(input: ArrayBuffer): ArrayBuffer {\n    const simpleZstd = new zstd.Simple();\n    // var ddict = new zstd.Dict.Decompression(dictData);\n    // var jsonBytes = simpleZstd.decompressUsingDict(jsonZstData, ddict);\n    const inputArray = new Uint8Array(input);\n    return simpleZstd.decompress(inputArray).buffer;\n  }\n}\n"],"mappings":"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"}