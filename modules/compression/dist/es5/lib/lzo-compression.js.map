{"version":3,"file":"lzo-compression.js","names":["_loaderUtils","require","_compression","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf2","default","result","NewTarget","constructor","Reflect","construct","arguments","apply","_possibleConstructorReturn2","sham","Proxy","Boolean","prototype","valueOf","call","e","lzo","LZOCompression","_Compression","_inherits2","_super","options","_this$options","_this$options$modules","_this","_classCallCheck2","_defineProperty2","_assertThisInitialized2","modules","Error","name","_createClass2","key","value","_preload","_asyncToGenerator2","_regenerator","mark","_callee","wrap","_callee$","_context","prev","next","stop","preload","_compress","_callee2","input","inputBuffer","_callee2$","_context2","toBuffer","abrupt","compress","buffer","_x","_decompress","_callee3","_callee3$","_context3","decompress","t0","_x2","Compression","exports"],"sources":["../../../src/lib/lzo-compression.ts"],"sourcesContent":["// LZO\n// import {loadLibrary} from '@loaders.gl/worker-utils';\nimport {toBuffer} from '@loaders.gl/loader-utils';\n\nimport type {CompressionOptions} from './compression';\nimport {Compression} from './compression';\n// import {isBrowser} from '@loaders.gl/loader-utils';\n\n// import lzo from 'lzo'; // https://bundlephobia.com/package/lzo\n// import {decompress} from 'lzo-wasm';\n\n// const LZO_WASM_JS_URL = './node_modules/lzo-wasm/lzo-wasm.js';\n// const LZO_WASM_WASM_URL = './node_modules/lzo-wasm/lzo-wasm.wasm';\n\nlet lzo;\n\n/**\n * Lempel-Ziv-Oberheimer compression / decompression\n */\nexport class LZOCompression extends Compression {\n  readonly name = 'lzo';\n  readonly extensions = [];\n  readonly contentEncodings = [];\n  readonly isSupported = false; // !isBrowser;\n  readonly options: CompressionOptions;\n\n  /**\n   * lzo is an injectable dependency due to big size\n   * @param options\n   */\n  constructor(options: CompressionOptions) {\n    super(options);\n    this.options = options;\n\n    lzo = lzo || this.options?.modules?.lzo;\n    if (!lzo) {\n      throw new Error(this.name);\n    }\n  }\n\n  async preload() {\n    // await loadLibrary(LZO_WASM_JS_URL);\n    // await loadLibrary(LZO_WASM_WASM_URL);\n  }\n\n  async compress(input: ArrayBuffer): Promise<ArrayBuffer> {\n    await this.preload();\n    // const inputArray = new Uint8Array(input);\n    const inputBuffer = toBuffer(input);\n    return lzo.compress(inputBuffer).buffer;\n  }\n\n  async decompress(input: ArrayBuffer): Promise<ArrayBuffer> {\n    try {\n      await this.preload();\n      // const inputArray = new Uint8Array(input);\n      const inputBuffer = toBuffer(input);\n      return lzo.decompress(inputBuffer).buffer;\n    } catch (error) {\n      // TODO - solve SharedArrayBuffer issues\n      // return decompress(input);\n      throw error;\n    }\n  }\n}\n"],"mappings":"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"}