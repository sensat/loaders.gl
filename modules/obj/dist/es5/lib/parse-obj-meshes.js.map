{"version":3,"file":"parse-obj-meshes.js","names":["OBJECT_RE","MATERIAL_RE","MATERIAL_USE_RE","MeshMaterial","_ref","index","_ref$name","name","mtllib","smooth","groupStart","_classCallCheck2","default","groupEnd","groupCount","inherited","_createClass2","key","value","clone","arguments","length","undefined","MeshObject","geometry","vertices","normals","colors","uvs","materials","fromDeclaration","startMaterial","libraries","previous","_finalize","splice","material","Array","isArray","push","currentMaterial","end","lastMultiMaterial","mi","ParserState","objects","object","materialLibraries","startObject","previousMaterial","declared","finalize","parseVertexIndex","len","parseInt","parseNormalIndex","parseUVIndex","addVertex","a","b","c","src","dst","addVertexPoint","addVertexLine","addNormal","addColor","addUV","addUVLine","addFace","ua","ub","uc","na","nb","nc","vLen","ia","ib","ic","uvLen","nLen","addPointGeometry","type","_iterator","_createForOfIteratorHelper","_step","s","n","done","vertex","err","e","f","addLineGeometry","_iterator2","_step2","_iterator3","_step3","uv","parseOBJMeshes","text","state","indexOf","replace","lines","split","line","lineFirstChar","lineLength","result","trimLeft","i","l","trim","charAt","data","parseFloat","lineData","substr","vertexData","faceVertices","j","jl","vertexParts","v1","v2","v3","lineParts","substring","lineVertices","lineUVs","li","llen","parts","pointData","exec","test","toLowerCase","Error","concat","meshes","_iterator4","_step4","mesh","header","vertexCount","attributes","mode","POSITION","Float32Array","size","NORMAL","COLOR_0","TEXCOORD_0","_iterator5","_step5","sourceMaterial","_material","flatShading"],"sources":["../../../src/lib/parse-obj-meshes.ts"],"sourcesContent":["// OBJ Loader, adapted from THREE.js (MIT license)\n//\n// Attributions per original THREE.js source file:\n//\n// @author mrdoob / http://mrdoob.com/\n\n// @ts-nocheck\n\n// o object_name | g group_name\nconst OBJECT_RE = /^[og]\\s*(.+)?/;\n// mtllib file_reference\nconst MATERIAL_RE = /^mtllib /;\n// usemtl material_name\nconst MATERIAL_USE_RE = /^usemtl /;\n\nclass MeshMaterial {\n  constructor({index, name = '', mtllib, smooth, groupStart}) {\n    this.index = index;\n    this.name = name;\n    this.mtllib = mtllib;\n    this.smooth = smooth;\n    this.groupStart = groupStart;\n    this.groupEnd = -1;\n    this.groupCount = -1;\n    this.inherited = false;\n  }\n\n  clone(index = this.index) {\n    return new MeshMaterial({\n      index,\n      name: this.name,\n      mtllib: this.mtllib,\n      smooth: this.smooth,\n      groupStart: 0\n    });\n  }\n}\n\nclass MeshObject {\n  constructor(name = '') {\n    this.name = name;\n\n    this.geometry = {\n      vertices: [],\n      normals: [],\n      colors: [],\n      uvs: []\n    };\n\n    this.materials = [];\n    this.smooth = true;\n\n    this.fromDeclaration = null;\n  }\n\n  startMaterial(name, libraries) {\n    const previous = this._finalize(false);\n\n    // New usemtl declaration overwrites an inherited material, except if faces were declared\n    // after the material, then it must be preserved for proper MultiMaterial continuation.\n    if (previous && (previous.inherited || previous.groupCount <= 0)) {\n      this.materials.splice(previous.index, 1);\n    }\n\n    const material = new MeshMaterial({\n      index: this.materials.length,\n      name,\n      mtllib:\n        Array.isArray(libraries) && libraries.length > 0 ? libraries[libraries.length - 1] : '',\n      smooth: previous !== undefined ? previous.smooth : this.smooth,\n      groupStart: previous !== undefined ? previous.groupEnd : 0\n    });\n\n    this.materials.push(material);\n\n    return material;\n  }\n\n  currentMaterial() {\n    if (this.materials.length > 0) {\n      return this.materials[this.materials.length - 1];\n    }\n\n    return undefined;\n  }\n\n  _finalize(end) {\n    const lastMultiMaterial = this.currentMaterial();\n    if (lastMultiMaterial && lastMultiMaterial.groupEnd === -1) {\n      lastMultiMaterial.groupEnd = this.geometry.vertices.length / 3;\n      lastMultiMaterial.groupCount = lastMultiMaterial.groupEnd - lastMultiMaterial.groupStart;\n      lastMultiMaterial.inherited = false;\n    }\n\n    // Ignore objects tail materials if no face declarations followed them before a new o/g started.\n    if (end && this.materials.length > 1) {\n      for (let mi = this.materials.length - 1; mi >= 0; mi--) {\n        if (this.materials[mi].groupCount <= 0) {\n          this.materials.splice(mi, 1);\n        }\n      }\n    }\n\n    // Guarantee at least one empty material, this makes the creation later more straight forward.\n    if (end && this.materials.length === 0) {\n      this.materials.push({\n        name: '',\n        smooth: this.smooth\n      });\n    }\n\n    return lastMultiMaterial;\n  }\n}\n\nclass ParserState {\n  constructor() {\n    this.objects = [];\n    this.object = null;\n\n    this.vertices = [];\n    this.normals = [];\n    this.colors = [];\n    this.uvs = [];\n\n    this.materialLibraries = [];\n\n    this.startObject('', false);\n  }\n\n  startObject(name, fromDeclaration = true) {\n    // If the current object (initial from reset) is not from a g/o declaration in the parsed\n    // file. We need to use it for the first parsed g/o to keep things in sync.\n    if (this.object && !this.object.fromDeclaration) {\n      this.object.name = name;\n      this.object.fromDeclaration = fromDeclaration;\n      return;\n    }\n\n    const previousMaterial =\n      this.object && typeof this.object.currentMaterial === 'function'\n        ? this.object.currentMaterial()\n        : undefined;\n\n    if (this.object && typeof this.object._finalize === 'function') {\n      this.object._finalize(true);\n    }\n\n    this.object = new MeshObject(name);\n    this.object.fromDeclaration = fromDeclaration;\n\n    // Inherit previous objects material.\n    // Spec tells us that a declared material must be set to all objects until a new material is declared.\n    // If a usemtl declaration is encountered while this new object is being parsed, it will\n    // overwrite the inherited material. Exception being that there was already face declarations\n    // to the inherited material, then it will be preserved for proper MultiMaterial continuation.\n    if (previousMaterial && previousMaterial.name && typeof previousMaterial.clone === 'function') {\n      const declared = previousMaterial.clone(0);\n      declared.inherited = true;\n      this.object.materials.push(declared);\n    }\n\n    this.objects.push(this.object);\n  }\n\n  finalize() {\n    if (this.object && typeof this.object._finalize === 'function') {\n      this.object._finalize(true);\n    }\n  }\n\n  parseVertexIndex(value, len) {\n    const index = parseInt(value);\n    return (index >= 0 ? index - 1 : index + len / 3) * 3;\n  }\n\n  parseNormalIndex(value, len) {\n    const index = parseInt(value);\n    return (index >= 0 ? index - 1 : index + len / 3) * 3;\n  }\n\n  parseUVIndex(value, len) {\n    const index = parseInt(value);\n    return (index >= 0 ? index - 1 : index + len / 2) * 2;\n  }\n\n  addVertex(a, b, c) {\n    const src = this.vertices;\n    const dst = this.object.geometry.vertices;\n\n    dst.push(src[a + 0], src[a + 1], src[a + 2]);\n    dst.push(src[b + 0], src[b + 1], src[b + 2]);\n    dst.push(src[c + 0], src[c + 1], src[c + 2]);\n  }\n\n  addVertexPoint(a) {\n    const src = this.vertices;\n    const dst = this.object.geometry.vertices;\n\n    dst.push(src[a + 0], src[a + 1], src[a + 2]);\n  }\n\n  addVertexLine(a) {\n    const src = this.vertices;\n    const dst = this.object.geometry.vertices;\n\n    dst.push(src[a + 0], src[a + 1], src[a + 2]);\n  }\n\n  addNormal(a, b, c) {\n    const src = this.normals;\n    const dst = this.object.geometry.normals;\n\n    dst.push(src[a + 0], src[a + 1], src[a + 2]);\n    dst.push(src[b + 0], src[b + 1], src[b + 2]);\n    dst.push(src[c + 0], src[c + 1], src[c + 2]);\n  }\n\n  addColor(a, b, c) {\n    const src = this.colors;\n    const dst = this.object.geometry.colors;\n\n    dst.push(src[a + 0], src[a + 1], src[a + 2]);\n    dst.push(src[b + 0], src[b + 1], src[b + 2]);\n    dst.push(src[c + 0], src[c + 1], src[c + 2]);\n  }\n\n  addUV(a, b, c) {\n    const src = this.uvs;\n    const dst = this.object.geometry.uvs;\n\n    dst.push(src[a + 0], src[a + 1]);\n    dst.push(src[b + 0], src[b + 1]);\n    dst.push(src[c + 0], src[c + 1]);\n  }\n\n  addUVLine(a) {\n    const src = this.uvs;\n    const dst = this.object.geometry.uvs;\n\n    dst.push(src[a + 0], src[a + 1]);\n  }\n\n  // eslint-disable-next-line max-params\n  addFace(a, b, c, ua, ub, uc, na, nb, nc) {\n    const vLen = this.vertices.length;\n\n    let ia = this.parseVertexIndex(a, vLen);\n    let ib = this.parseVertexIndex(b, vLen);\n    let ic = this.parseVertexIndex(c, vLen);\n\n    this.addVertex(ia, ib, ic);\n\n    if (ua !== undefined && ua !== '') {\n      const uvLen = this.uvs.length;\n      ia = this.parseUVIndex(ua, uvLen);\n      ib = this.parseUVIndex(ub, uvLen);\n      ic = this.parseUVIndex(uc, uvLen);\n      this.addUV(ia, ib, ic);\n    }\n\n    if (na !== undefined && na !== '') {\n      // Normals are many times the same. If so, skip function call and parseInt.\n      const nLen = this.normals.length;\n      ia = this.parseNormalIndex(na, nLen);\n\n      ib = na === nb ? ia : this.parseNormalIndex(nb, nLen);\n      ic = na === nc ? ia : this.parseNormalIndex(nc, nLen);\n\n      this.addNormal(ia, ib, ic);\n    }\n\n    if (this.colors.length > 0) {\n      this.addColor(ia, ib, ic);\n    }\n  }\n\n  addPointGeometry(vertices) {\n    this.object.geometry.type = 'Points';\n\n    const vLen = this.vertices.length;\n\n    for (const vertex of vertices) {\n      this.addVertexPoint(this.parseVertexIndex(vertex, vLen));\n    }\n  }\n\n  addLineGeometry(vertices, uvs) {\n    this.object.geometry.type = 'Line';\n\n    const vLen = this.vertices.length;\n    const uvLen = this.uvs.length;\n\n    for (const vertex of vertices) {\n      this.addVertexLine(this.parseVertexIndex(vertex, vLen));\n    }\n\n    for (const uv of uvs) {\n      this.addUVLine(this.parseUVIndex(uv, uvLen));\n    }\n  }\n}\n\n// eslint-disable-next-line max-statements, complexity\nexport function parseOBJMeshes(text) {\n  const state = new ParserState();\n\n  if (text.indexOf('\\r\\n') !== -1) {\n    // This is faster than String.split with regex that splits on both\n    text = text.replace(/\\r\\n/g, '\\n');\n  }\n\n  if (text.indexOf('\\\\\\n') !== -1) {\n    // join lines separated by a line continuation character (\\)\n    text = text.replace(/\\\\\\n/g, '');\n  }\n\n  const lines = text.split('\\n');\n  let line = '';\n  let lineFirstChar = '';\n  let lineLength = 0;\n  let result = [];\n\n  // Faster to just trim left side of the line. Use if available.\n  const trimLeft = typeof ''.trimLeft === 'function';\n\n  /* eslint-disable no-continue, max-depth */\n  for (let i = 0, l = lines.length; i < l; i++) {\n    line = lines[i];\n    line = trimLeft ? line.trimLeft() : line.trim();\n    lineLength = line.length;\n\n    if (lineLength === 0) continue;\n\n    lineFirstChar = line.charAt(0);\n\n    // @todo invoke passed in handler if any\n    if (lineFirstChar === '#') continue;\n\n    if (lineFirstChar === 'v') {\n      const data = line.split(/\\s+/);\n\n      switch (data[0]) {\n        case 'v':\n          state.vertices.push(parseFloat(data[1]), parseFloat(data[2]), parseFloat(data[3]));\n          if (data.length === 8) {\n            state.colors.push(parseFloat(data[4]), parseFloat(data[5]), parseFloat(data[6]));\n          }\n          break;\n        case 'vn':\n          state.normals.push(parseFloat(data[1]), parseFloat(data[2]), parseFloat(data[3]));\n          break;\n        case 'vt':\n          state.uvs.push(parseFloat(data[1]), parseFloat(data[2]));\n          break;\n        default:\n      }\n    } else if (lineFirstChar === 'f') {\n      const lineData = line.substr(1).trim();\n      const vertexData = lineData.split(/\\s+/);\n      const faceVertices = [];\n\n      // Parse the face vertex data into an easy to work with format\n\n      for (let j = 0, jl = vertexData.length; j < jl; j++) {\n        const vertex = vertexData[j];\n\n        if (vertex.length > 0) {\n          const vertexParts = vertex.split('/');\n          faceVertices.push(vertexParts);\n        }\n      }\n\n      // Draw an edge between the first vertex and all subsequent vertices to form an n-gon\n\n      const v1 = faceVertices[0];\n\n      for (let j = 1, jl = faceVertices.length - 1; j < jl; j++) {\n        const v2 = faceVertices[j];\n        const v3 = faceVertices[j + 1];\n\n        state.addFace(v1[0], v2[0], v3[0], v1[1], v2[1], v3[1], v1[2], v2[2], v3[2]);\n      }\n    } else if (lineFirstChar === 'l') {\n      const lineParts = line.substring(1).trim().split(' ');\n      let lineVertices;\n      const lineUVs = [];\n\n      if (line.indexOf('/') === -1) {\n        lineVertices = lineParts;\n      } else {\n        lineVertices = [];\n        for (let li = 0, llen = lineParts.length; li < llen; li++) {\n          const parts = lineParts[li].split('/');\n\n          if (parts[0] !== '') lineVertices.push(parts[0]);\n          if (parts[1] !== '') lineUVs.push(parts[1]);\n        }\n      }\n      state.addLineGeometry(lineVertices, lineUVs);\n    } else if (lineFirstChar === 'p') {\n      const lineData = line.substr(1).trim();\n      const pointData = lineData.split(' ');\n\n      state.addPointGeometry(pointData);\n    } else if ((result = OBJECT_RE.exec(line)) !== null) {\n      // o object_name\n      // or\n      // g group_name\n\n      // WORKAROUND: https://bugs.chromium.org/p/v8/issues/detail?id=2869\n      // var name = result[ 0 ].substr( 1 ).trim();\n      const name = (' ' + result[0].substr(1).trim()).substr(1); // eslint-disable-line\n\n      state.startObject(name);\n    } else if (MATERIAL_USE_RE.test(line)) {\n      // material\n\n      state.object.startMaterial(line.substring(7).trim(), state.materialLibraries);\n    } else if (MATERIAL_RE.test(line)) {\n      // mtl file\n\n      state.materialLibraries.push(line.substring(7).trim());\n    } else if (lineFirstChar === 's') {\n      result = line.split(' ');\n\n      // smooth shading\n\n      // @todo Handle files that have varying smooth values for a set of faces inside one geometry,\n      // but does not define a usemtl for each face set.\n      // This should be detected and a dummy material created (later MultiMaterial and geometry groups).\n      // This requires some care to not create extra material on each smooth value for \"normal\" obj files.\n      // where explicit usemtl defines geometry groups.\n      // Example asset: examples/models/obj/cerberus/Cerberus.obj\n\n      /*\n       * http://paulbourke.net/dataformats/obj/\n       * or\n       * http://www.cs.utah.edu/~boulos/cs3505/obj_spec.pdf\n       *\n       * From chapter \"Grouping\" Syntax explanation \"s group_number\":\n       * \"group_number is the smoothing group number. To turn off smoothing groups, use a value of 0 or off.\n       * Polygonal elements use group numbers to put elements in different smoothing groups. For free-form\n       * surfaces, smoothing groups are either turned on or off; there is no difference between values greater\n       * than 0.\"\n       */\n      if (result.length > 1) {\n        const value = result[1].trim().toLowerCase();\n        state.object.smooth = value !== '0' && value !== 'off';\n      } else {\n        // ZBrush can produce \"s\" lines #11707\n        state.object.smooth = true;\n      }\n      const material = state.object.currentMaterial();\n      if (material) material.smooth = state.object.smooth;\n    } else {\n      // Handle null terminated files without exception\n      if (line === '\\0') continue;\n\n      throw new Error(`Unexpected line: \"${line}\"`);\n    }\n  }\n\n  state.finalize();\n\n  const meshes = [];\n  const materials = [];\n\n  for (const object of state.objects) {\n    const {geometry} = object;\n\n    // Skip o/g line declarations that did not follow with any faces\n    if (geometry.vertices.length === 0) continue;\n\n    const mesh = {\n      header: {\n        vertexCount: geometry.vertices.length / 3\n      },\n      attributes: {}\n    };\n\n    switch (geometry.type) {\n      case 'Points':\n        mesh.mode = 0; // GL.POINTS\n        break;\n      case 'Line':\n        mesh.mode = 1; // GL.LINES\n        break;\n      default:\n        mesh.mode = 4; // GL.TRIANGLES\n        break;\n    }\n\n    mesh.attributes.POSITION = {value: new Float32Array(geometry.vertices), size: 3};\n\n    if (geometry.normals.length > 0) {\n      mesh.attributes.NORMAL = {value: new Float32Array(geometry.normals), size: 3};\n    }\n\n    if (geometry.colors.length > 0) {\n      mesh.attributes.COLOR_0 = {value: new Float32Array(geometry.colors), size: 3};\n    }\n\n    if (geometry.uvs.length > 0) {\n      mesh.attributes.TEXCOORD_0 = {value: new Float32Array(geometry.uvs), size: 2};\n    }\n\n    // Create materials\n    mesh.materials = [];\n    for (const sourceMaterial of object.materials) {\n      // TODO - support full spec\n      const _material = {\n        name: sourceMaterial.name,\n        flatShading: !sourceMaterial.smooth\n      };\n      mesh.materials.push(_material);\n      materials.push(_material);\n    }\n\n    mesh.name = object.name;\n    meshes.push(mesh);\n  }\n\n  return {meshes, materials};\n}\n"],"mappings":"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"}