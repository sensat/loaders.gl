{"version":3,"file":"parse-obj-meshes.js","names":["OBJECT_RE","MATERIAL_RE","MATERIAL_USE_RE","MeshMaterial","constructor","_ref","index","name","mtllib","smooth","groupStart","groupEnd","groupCount","inherited","clone","arguments","length","undefined","MeshObject","geometry","vertices","normals","colors","uvs","materials","fromDeclaration","startMaterial","libraries","previous","_finalize","splice","material","Array","isArray","push","currentMaterial","end","lastMultiMaterial","mi","ParserState","objects","object","materialLibraries","startObject","previousMaterial","declared","finalize","parseVertexIndex","value","len","parseInt","parseNormalIndex","parseUVIndex","addVertex","a","b","c","src","dst","addVertexPoint","addVertexLine","addNormal","addColor","addUV","addUVLine","addFace","ua","ub","uc","na","nb","nc","vLen","ia","ib","ic","uvLen","nLen","addPointGeometry","type","vertex","addLineGeometry","uv","parseOBJMeshes","text","state","indexOf","replace","lines","split","line","lineFirstChar","lineLength","result","trimLeft","i","l","trim","charAt","data","parseFloat","lineData","substr","vertexData","faceVertices","j","jl","vertexParts","v1","v2","v3","lineParts","substring","lineVertices","lineUVs","li","llen","parts","pointData","exec","test","toLowerCase","Error","concat","meshes","mesh","header","vertexCount","attributes","mode","POSITION","Float32Array","size","NORMAL","COLOR_0","TEXCOORD_0","sourceMaterial","_material","flatShading"],"sources":["../../../src/lib/parse-obj-meshes.ts"],"sourcesContent":["// OBJ Loader, adapted from THREE.js (MIT license)\n//\n// Attributions per original THREE.js source file:\n//\n// @author mrdoob / http://mrdoob.com/\n\n// @ts-nocheck\n\n// o object_name | g group_name\nconst OBJECT_RE = /^[og]\\s*(.+)?/;\n// mtllib file_reference\nconst MATERIAL_RE = /^mtllib /;\n// usemtl material_name\nconst MATERIAL_USE_RE = /^usemtl /;\n\nclass MeshMaterial {\n  constructor({index, name = '', mtllib, smooth, groupStart}) {\n    this.index = index;\n    this.name = name;\n    this.mtllib = mtllib;\n    this.smooth = smooth;\n    this.groupStart = groupStart;\n    this.groupEnd = -1;\n    this.groupCount = -1;\n    this.inherited = false;\n  }\n\n  clone(index = this.index) {\n    return new MeshMaterial({\n      index,\n      name: this.name,\n      mtllib: this.mtllib,\n      smooth: this.smooth,\n      groupStart: 0\n    });\n  }\n}\n\nclass MeshObject {\n  constructor(name = '') {\n    this.name = name;\n\n    this.geometry = {\n      vertices: [],\n      normals: [],\n      colors: [],\n      uvs: []\n    };\n\n    this.materials = [];\n    this.smooth = true;\n\n    this.fromDeclaration = null;\n  }\n\n  startMaterial(name, libraries) {\n    const previous = this._finalize(false);\n\n    // New usemtl declaration overwrites an inherited material, except if faces were declared\n    // after the material, then it must be preserved for proper MultiMaterial continuation.\n    if (previous && (previous.inherited || previous.groupCount <= 0)) {\n      this.materials.splice(previous.index, 1);\n    }\n\n    const material = new MeshMaterial({\n      index: this.materials.length,\n      name,\n      mtllib:\n        Array.isArray(libraries) && libraries.length > 0 ? libraries[libraries.length - 1] : '',\n      smooth: previous !== undefined ? previous.smooth : this.smooth,\n      groupStart: previous !== undefined ? previous.groupEnd : 0\n    });\n\n    this.materials.push(material);\n\n    return material;\n  }\n\n  currentMaterial() {\n    if (this.materials.length > 0) {\n      return this.materials[this.materials.length - 1];\n    }\n\n    return undefined;\n  }\n\n  _finalize(end) {\n    const lastMultiMaterial = this.currentMaterial();\n    if (lastMultiMaterial && lastMultiMaterial.groupEnd === -1) {\n      lastMultiMaterial.groupEnd = this.geometry.vertices.length / 3;\n      lastMultiMaterial.groupCount = lastMultiMaterial.groupEnd - lastMultiMaterial.groupStart;\n      lastMultiMaterial.inherited = false;\n    }\n\n    // Ignore objects tail materials if no face declarations followed them before a new o/g started.\n    if (end && this.materials.length > 1) {\n      for (let mi = this.materials.length - 1; mi >= 0; mi--) {\n        if (this.materials[mi].groupCount <= 0) {\n          this.materials.splice(mi, 1);\n        }\n      }\n    }\n\n    // Guarantee at least one empty material, this makes the creation later more straight forward.\n    if (end && this.materials.length === 0) {\n      this.materials.push({\n        name: '',\n        smooth: this.smooth\n      });\n    }\n\n    return lastMultiMaterial;\n  }\n}\n\nclass ParserState {\n  constructor() {\n    this.objects = [];\n    this.object = null;\n\n    this.vertices = [];\n    this.normals = [];\n    this.colors = [];\n    this.uvs = [];\n\n    this.materialLibraries = [];\n\n    this.startObject('', false);\n  }\n\n  startObject(name, fromDeclaration = true) {\n    // If the current object (initial from reset) is not from a g/o declaration in the parsed\n    // file. We need to use it for the first parsed g/o to keep things in sync.\n    if (this.object && !this.object.fromDeclaration) {\n      this.object.name = name;\n      this.object.fromDeclaration = fromDeclaration;\n      return;\n    }\n\n    const previousMaterial =\n      this.object && typeof this.object.currentMaterial === 'function'\n        ? this.object.currentMaterial()\n        : undefined;\n\n    if (this.object && typeof this.object._finalize === 'function') {\n      this.object._finalize(true);\n    }\n\n    this.object = new MeshObject(name);\n    this.object.fromDeclaration = fromDeclaration;\n\n    // Inherit previous objects material.\n    // Spec tells us that a declared material must be set to all objects until a new material is declared.\n    // If a usemtl declaration is encountered while this new object is being parsed, it will\n    // overwrite the inherited material. Exception being that there was already face declarations\n    // to the inherited material, then it will be preserved for proper MultiMaterial continuation.\n    if (previousMaterial && previousMaterial.name && typeof previousMaterial.clone === 'function') {\n      const declared = previousMaterial.clone(0);\n      declared.inherited = true;\n      this.object.materials.push(declared);\n    }\n\n    this.objects.push(this.object);\n  }\n\n  finalize() {\n    if (this.object && typeof this.object._finalize === 'function') {\n      this.object._finalize(true);\n    }\n  }\n\n  parseVertexIndex(value, len) {\n    const index = parseInt(value);\n    return (index >= 0 ? index - 1 : index + len / 3) * 3;\n  }\n\n  parseNormalIndex(value, len) {\n    const index = parseInt(value);\n    return (index >= 0 ? index - 1 : index + len / 3) * 3;\n  }\n\n  parseUVIndex(value, len) {\n    const index = parseInt(value);\n    return (index >= 0 ? index - 1 : index + len / 2) * 2;\n  }\n\n  addVertex(a, b, c) {\n    const src = this.vertices;\n    const dst = this.object.geometry.vertices;\n\n    dst.push(src[a + 0], src[a + 1], src[a + 2]);\n    dst.push(src[b + 0], src[b + 1], src[b + 2]);\n    dst.push(src[c + 0], src[c + 1], src[c + 2]);\n  }\n\n  addVertexPoint(a) {\n    const src = this.vertices;\n    const dst = this.object.geometry.vertices;\n\n    dst.push(src[a + 0], src[a + 1], src[a + 2]);\n  }\n\n  addVertexLine(a) {\n    const src = this.vertices;\n    const dst = this.object.geometry.vertices;\n\n    dst.push(src[a + 0], src[a + 1], src[a + 2]);\n  }\n\n  addNormal(a, b, c) {\n    const src = this.normals;\n    const dst = this.object.geometry.normals;\n\n    dst.push(src[a + 0], src[a + 1], src[a + 2]);\n    dst.push(src[b + 0], src[b + 1], src[b + 2]);\n    dst.push(src[c + 0], src[c + 1], src[c + 2]);\n  }\n\n  addColor(a, b, c) {\n    const src = this.colors;\n    const dst = this.object.geometry.colors;\n\n    dst.push(src[a + 0], src[a + 1], src[a + 2]);\n    dst.push(src[b + 0], src[b + 1], src[b + 2]);\n    dst.push(src[c + 0], src[c + 1], src[c + 2]);\n  }\n\n  addUV(a, b, c) {\n    const src = this.uvs;\n    const dst = this.object.geometry.uvs;\n\n    dst.push(src[a + 0], src[a + 1]);\n    dst.push(src[b + 0], src[b + 1]);\n    dst.push(src[c + 0], src[c + 1]);\n  }\n\n  addUVLine(a) {\n    const src = this.uvs;\n    const dst = this.object.geometry.uvs;\n\n    dst.push(src[a + 0], src[a + 1]);\n  }\n\n  // eslint-disable-next-line max-params\n  addFace(a, b, c, ua, ub, uc, na, nb, nc) {\n    const vLen = this.vertices.length;\n\n    let ia = this.parseVertexIndex(a, vLen);\n    let ib = this.parseVertexIndex(b, vLen);\n    let ic = this.parseVertexIndex(c, vLen);\n\n    this.addVertex(ia, ib, ic);\n\n    if (ua !== undefined && ua !== '') {\n      const uvLen = this.uvs.length;\n      ia = this.parseUVIndex(ua, uvLen);\n      ib = this.parseUVIndex(ub, uvLen);\n      ic = this.parseUVIndex(uc, uvLen);\n      this.addUV(ia, ib, ic);\n    }\n\n    if (na !== undefined && na !== '') {\n      // Normals are many times the same. If so, skip function call and parseInt.\n      const nLen = this.normals.length;\n      ia = this.parseNormalIndex(na, nLen);\n\n      ib = na === nb ? ia : this.parseNormalIndex(nb, nLen);\n      ic = na === nc ? ia : this.parseNormalIndex(nc, nLen);\n\n      this.addNormal(ia, ib, ic);\n    }\n\n    if (this.colors.length > 0) {\n      this.addColor(ia, ib, ic);\n    }\n  }\n\n  addPointGeometry(vertices) {\n    this.object.geometry.type = 'Points';\n\n    const vLen = this.vertices.length;\n\n    for (const vertex of vertices) {\n      this.addVertexPoint(this.parseVertexIndex(vertex, vLen));\n    }\n  }\n\n  addLineGeometry(vertices, uvs) {\n    this.object.geometry.type = 'Line';\n\n    const vLen = this.vertices.length;\n    const uvLen = this.uvs.length;\n\n    for (const vertex of vertices) {\n      this.addVertexLine(this.parseVertexIndex(vertex, vLen));\n    }\n\n    for (const uv of uvs) {\n      this.addUVLine(this.parseUVIndex(uv, uvLen));\n    }\n  }\n}\n\n// eslint-disable-next-line max-statements, complexity\nexport function parseOBJMeshes(text) {\n  const state = new ParserState();\n\n  if (text.indexOf('\\r\\n') !== -1) {\n    // This is faster than String.split with regex that splits on both\n    text = text.replace(/\\r\\n/g, '\\n');\n  }\n\n  if (text.indexOf('\\\\\\n') !== -1) {\n    // join lines separated by a line continuation character (\\)\n    text = text.replace(/\\\\\\n/g, '');\n  }\n\n  const lines = text.split('\\n');\n  let line = '';\n  let lineFirstChar = '';\n  let lineLength = 0;\n  let result = [];\n\n  // Faster to just trim left side of the line. Use if available.\n  const trimLeft = typeof ''.trimLeft === 'function';\n\n  /* eslint-disable no-continue, max-depth */\n  for (let i = 0, l = lines.length; i < l; i++) {\n    line = lines[i];\n    line = trimLeft ? line.trimLeft() : line.trim();\n    lineLength = line.length;\n\n    if (lineLength === 0) continue;\n\n    lineFirstChar = line.charAt(0);\n\n    // @todo invoke passed in handler if any\n    if (lineFirstChar === '#') continue;\n\n    if (lineFirstChar === 'v') {\n      const data = line.split(/\\s+/);\n\n      switch (data[0]) {\n        case 'v':\n          state.vertices.push(parseFloat(data[1]), parseFloat(data[2]), parseFloat(data[3]));\n          if (data.length === 8) {\n            state.colors.push(parseFloat(data[4]), parseFloat(data[5]), parseFloat(data[6]));\n          }\n          break;\n        case 'vn':\n          state.normals.push(parseFloat(data[1]), parseFloat(data[2]), parseFloat(data[3]));\n          break;\n        case 'vt':\n          state.uvs.push(parseFloat(data[1]), parseFloat(data[2]));\n          break;\n        default:\n      }\n    } else if (lineFirstChar === 'f') {\n      const lineData = line.substr(1).trim();\n      const vertexData = lineData.split(/\\s+/);\n      const faceVertices = [];\n\n      // Parse the face vertex data into an easy to work with format\n\n      for (let j = 0, jl = vertexData.length; j < jl; j++) {\n        const vertex = vertexData[j];\n\n        if (vertex.length > 0) {\n          const vertexParts = vertex.split('/');\n          faceVertices.push(vertexParts);\n        }\n      }\n\n      // Draw an edge between the first vertex and all subsequent vertices to form an n-gon\n\n      const v1 = faceVertices[0];\n\n      for (let j = 1, jl = faceVertices.length - 1; j < jl; j++) {\n        const v2 = faceVertices[j];\n        const v3 = faceVertices[j + 1];\n\n        state.addFace(v1[0], v2[0], v3[0], v1[1], v2[1], v3[1], v1[2], v2[2], v3[2]);\n      }\n    } else if (lineFirstChar === 'l') {\n      const lineParts = line.substring(1).trim().split(' ');\n      let lineVertices;\n      const lineUVs = [];\n\n      if (line.indexOf('/') === -1) {\n        lineVertices = lineParts;\n      } else {\n        lineVertices = [];\n        for (let li = 0, llen = lineParts.length; li < llen; li++) {\n          const parts = lineParts[li].split('/');\n\n          if (parts[0] !== '') lineVertices.push(parts[0]);\n          if (parts[1] !== '') lineUVs.push(parts[1]);\n        }\n      }\n      state.addLineGeometry(lineVertices, lineUVs);\n    } else if (lineFirstChar === 'p') {\n      const lineData = line.substr(1).trim();\n      const pointData = lineData.split(' ');\n\n      state.addPointGeometry(pointData);\n    } else if ((result = OBJECT_RE.exec(line)) !== null) {\n      // o object_name\n      // or\n      // g group_name\n\n      // WORKAROUND: https://bugs.chromium.org/p/v8/issues/detail?id=2869\n      // var name = result[ 0 ].substr( 1 ).trim();\n      const name = (' ' + result[0].substr(1).trim()).substr(1); // eslint-disable-line\n\n      state.startObject(name);\n    } else if (MATERIAL_USE_RE.test(line)) {\n      // material\n\n      state.object.startMaterial(line.substring(7).trim(), state.materialLibraries);\n    } else if (MATERIAL_RE.test(line)) {\n      // mtl file\n\n      state.materialLibraries.push(line.substring(7).trim());\n    } else if (lineFirstChar === 's') {\n      result = line.split(' ');\n\n      // smooth shading\n\n      // @todo Handle files that have varying smooth values for a set of faces inside one geometry,\n      // but does not define a usemtl for each face set.\n      // This should be detected and a dummy material created (later MultiMaterial and geometry groups).\n      // This requires some care to not create extra material on each smooth value for \"normal\" obj files.\n      // where explicit usemtl defines geometry groups.\n      // Example asset: examples/models/obj/cerberus/Cerberus.obj\n\n      /*\n       * http://paulbourke.net/dataformats/obj/\n       * or\n       * http://www.cs.utah.edu/~boulos/cs3505/obj_spec.pdf\n       *\n       * From chapter \"Grouping\" Syntax explanation \"s group_number\":\n       * \"group_number is the smoothing group number. To turn off smoothing groups, use a value of 0 or off.\n       * Polygonal elements use group numbers to put elements in different smoothing groups. For free-form\n       * surfaces, smoothing groups are either turned on or off; there is no difference between values greater\n       * than 0.\"\n       */\n      if (result.length > 1) {\n        const value = result[1].trim().toLowerCase();\n        state.object.smooth = value !== '0' && value !== 'off';\n      } else {\n        // ZBrush can produce \"s\" lines #11707\n        state.object.smooth = true;\n      }\n      const material = state.object.currentMaterial();\n      if (material) material.smooth = state.object.smooth;\n    } else {\n      // Handle null terminated files without exception\n      if (line === '\\0') continue;\n\n      throw new Error(`Unexpected line: \"${line}\"`);\n    }\n  }\n\n  state.finalize();\n\n  const meshes = [];\n  const materials = [];\n\n  for (const object of state.objects) {\n    const {geometry} = object;\n\n    // Skip o/g line declarations that did not follow with any faces\n    if (geometry.vertices.length === 0) continue;\n\n    const mesh = {\n      header: {\n        vertexCount: geometry.vertices.length / 3\n      },\n      attributes: {}\n    };\n\n    switch (geometry.type) {\n      case 'Points':\n        mesh.mode = 0; // GL.POINTS\n        break;\n      case 'Line':\n        mesh.mode = 1; // GL.LINES\n        break;\n      default:\n        mesh.mode = 4; // GL.TRIANGLES\n        break;\n    }\n\n    mesh.attributes.POSITION = {value: new Float32Array(geometry.vertices), size: 3};\n\n    if (geometry.normals.length > 0) {\n      mesh.attributes.NORMAL = {value: new Float32Array(geometry.normals), size: 3};\n    }\n\n    if (geometry.colors.length > 0) {\n      mesh.attributes.COLOR_0 = {value: new Float32Array(geometry.colors), size: 3};\n    }\n\n    if (geometry.uvs.length > 0) {\n      mesh.attributes.TEXCOORD_0 = {value: new Float32Array(geometry.uvs), size: 2};\n    }\n\n    // Create materials\n    mesh.materials = [];\n    for (const sourceMaterial of object.materials) {\n      // TODO - support full spec\n      const _material = {\n        name: sourceMaterial.name,\n        flatShading: !sourceMaterial.smooth\n      };\n      mesh.materials.push(_material);\n      materials.push(_material);\n    }\n\n    mesh.name = object.name;\n    meshes.push(mesh);\n  }\n\n  return {meshes, materials};\n}\n"],"mappings":"AASA,MAAMA,SAAS,GAAG,eAAe;AAEjC,MAAMC,WAAW,GAAG,UAAU;AAE9B,MAAMC,eAAe,GAAG,UAAU;AAElC,MAAMC,YAAY,CAAC;EACjBC,WAAWA,CAAAC,IAAA,EAAiD;IAAA,IAAhD;MAACC,KAAK;MAAEC,IAAI,GAAG,EAAE;MAAEC,MAAM;MAAEC,MAAM;MAAEC;IAAU,CAAC,GAAAL,IAAA;IACxD,IAAI,CAACC,KAAK,GAAGA,KAAK;IAClB,IAAI,CAACC,IAAI,GAAGA,IAAI;IAChB,IAAI,CAACC,MAAM,GAAGA,MAAM;IACpB,IAAI,CAACC,MAAM,GAAGA,MAAM;IACpB,IAAI,CAACC,UAAU,GAAGA,UAAU;IAC5B,IAAI,CAACC,QAAQ,GAAG,CAAC,CAAC;IAClB,IAAI,CAACC,UAAU,GAAG,CAAC,CAAC;IACpB,IAAI,CAACC,SAAS,GAAG,KAAK;EACxB;EAEAC,KAAKA,CAAA,EAAqB;IAAA,IAApBR,KAAK,GAAAS,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,IAAI,CAACT,KAAK;IACtB,OAAO,IAAIH,YAAY,CAAC;MACtBG,KAAK;MACLC,IAAI,EAAE,IAAI,CAACA,IAAI;MACfC,MAAM,EAAE,IAAI,CAACA,MAAM;MACnBC,MAAM,EAAE,IAAI,CAACA,MAAM;MACnBC,UAAU,EAAE;IACd,CAAC,CAAC;EACJ;AACF;AAEA,MAAMQ,UAAU,CAAC;EACfd,WAAWA,CAAA,EAAY;IAAA,IAAXG,IAAI,GAAAQ,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,EAAE;IACnB,IAAI,CAACR,IAAI,GAAGA,IAAI;IAEhB,IAAI,CAACY,QAAQ,GAAG;MACdC,QAAQ,EAAE,EAAE;MACZC,OAAO,EAAE,EAAE;MACXC,MAAM,EAAE,EAAE;MACVC,GAAG,EAAE;IACP,CAAC;IAED,IAAI,CAACC,SAAS,GAAG,EAAE;IACnB,IAAI,CAACf,MAAM,GAAG,IAAI;IAElB,IAAI,CAACgB,eAAe,GAAG,IAAI;EAC7B;EAEAC,aAAaA,CAACnB,IAAI,EAAEoB,SAAS,EAAE;IAC7B,MAAMC,QAAQ,GAAG,IAAI,CAACC,SAAS,CAAC,KAAK,CAAC;IAItC,IAAID,QAAQ,KAAKA,QAAQ,CAACf,SAAS,IAAIe,QAAQ,CAAChB,UAAU,IAAI,CAAC,CAAC,EAAE;MAChE,IAAI,CAACY,SAAS,CAACM,MAAM,CAACF,QAAQ,CAACtB,KAAK,EAAE,CAAC,CAAC;IAC1C;IAEA,MAAMyB,QAAQ,GAAG,IAAI5B,YAAY,CAAC;MAChCG,KAAK,EAAE,IAAI,CAACkB,SAAS,CAACR,MAAM;MAC5BT,IAAI;MACJC,MAAM,EACJwB,KAAK,CAACC,OAAO,CAACN,SAAS,CAAC,IAAIA,SAAS,CAACX,MAAM,GAAG,CAAC,GAAGW,SAAS,CAACA,SAAS,CAACX,MAAM,GAAG,CAAC,CAAC,GAAG,EAAE;MACzFP,MAAM,EAAEmB,QAAQ,KAAKX,SAAS,GAAGW,QAAQ,CAACnB,MAAM,GAAG,IAAI,CAACA,MAAM;MAC9DC,UAAU,EAAEkB,QAAQ,KAAKX,SAAS,GAAGW,QAAQ,CAACjB,QAAQ,GAAG;IAC3D,CAAC,CAAC;IAEF,IAAI,CAACa,SAAS,CAACU,IAAI,CAACH,QAAQ,CAAC;IAE7B,OAAOA,QAAQ;EACjB;EAEAI,eAAeA,CAAA,EAAG;IAChB,IAAI,IAAI,CAACX,SAAS,CAACR,MAAM,GAAG,CAAC,EAAE;MAC7B,OAAO,IAAI,CAACQ,SAAS,CAAC,IAAI,CAACA,SAAS,CAACR,MAAM,GAAG,CAAC,CAAC;IAClD;IAEA,OAAOC,SAAS;EAClB;EAEAY,SAASA,CAACO,GAAG,EAAE;IACb,MAAMC,iBAAiB,GAAG,IAAI,CAACF,eAAe,CAAC,CAAC;IAChD,IAAIE,iBAAiB,IAAIA,iBAAiB,CAAC1B,QAAQ,KAAK,CAAC,CAAC,EAAE;MAC1D0B,iBAAiB,CAAC1B,QAAQ,GAAG,IAAI,CAACQ,QAAQ,CAACC,QAAQ,CAACJ,MAAM,GAAG,CAAC;MAC9DqB,iBAAiB,CAACzB,UAAU,GAAGyB,iBAAiB,CAAC1B,QAAQ,GAAG0B,iBAAiB,CAAC3B,UAAU;MACxF2B,iBAAiB,CAACxB,SAAS,GAAG,KAAK;IACrC;IAGA,IAAIuB,GAAG,IAAI,IAAI,CAACZ,SAAS,CAACR,MAAM,GAAG,CAAC,EAAE;MACpC,KAAK,IAAIsB,EAAE,GAAG,IAAI,CAACd,SAAS,CAACR,MAAM,GAAG,CAAC,EAAEsB,EAAE,IAAI,CAAC,EAAEA,EAAE,EAAE,EAAE;QACtD,IAAI,IAAI,CAACd,SAAS,CAACc,EAAE,CAAC,CAAC1B,UAAU,IAAI,CAAC,EAAE;UACtC,IAAI,CAACY,SAAS,CAACM,MAAM,CAACQ,EAAE,EAAE,CAAC,CAAC;QAC9B;MACF;IACF;IAGA,IAAIF,GAAG,IAAI,IAAI,CAACZ,SAAS,CAACR,MAAM,KAAK,CAAC,EAAE;MACtC,IAAI,CAACQ,SAAS,CAACU,IAAI,CAAC;QAClB3B,IAAI,EAAE,EAAE;QACRE,MAAM,EAAE,IAAI,CAACA;MACf,CAAC,CAAC;IACJ;IAEA,OAAO4B,iBAAiB;EAC1B;AACF;AAEA,MAAME,WAAW,CAAC;EAChBnC,WAAWA,CAAA,EAAG;IACZ,IAAI,CAACoC,OAAO,GAAG,EAAE;IACjB,IAAI,CAACC,MAAM,GAAG,IAAI;IAElB,IAAI,CAACrB,QAAQ,GAAG,EAAE;IAClB,IAAI,CAACC,OAAO,GAAG,EAAE;IACjB,IAAI,CAACC,MAAM,GAAG,EAAE;IAChB,IAAI,CAACC,GAAG,GAAG,EAAE;IAEb,IAAI,CAACmB,iBAAiB,GAAG,EAAE;IAE3B,IAAI,CAACC,WAAW,CAAC,EAAE,EAAE,KAAK,CAAC;EAC7B;EAEAA,WAAWA,CAACpC,IAAI,EAA0B;IAAA,IAAxBkB,eAAe,GAAAV,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,IAAI;IAGtC,IAAI,IAAI,CAAC0B,MAAM,IAAI,CAAC,IAAI,CAACA,MAAM,CAAChB,eAAe,EAAE;MAC/C,IAAI,CAACgB,MAAM,CAAClC,IAAI,GAAGA,IAAI;MACvB,IAAI,CAACkC,MAAM,CAAChB,eAAe,GAAGA,eAAe;MAC7C;IACF;IAEA,MAAMmB,gBAAgB,GACpB,IAAI,CAACH,MAAM,IAAI,OAAO,IAAI,CAACA,MAAM,CAACN,eAAe,KAAK,UAAU,GAC5D,IAAI,CAACM,MAAM,CAACN,eAAe,CAAC,CAAC,GAC7BlB,SAAS;IAEf,IAAI,IAAI,CAACwB,MAAM,IAAI,OAAO,IAAI,CAACA,MAAM,CAACZ,SAAS,KAAK,UAAU,EAAE;MAC9D,IAAI,CAACY,MAAM,CAACZ,SAAS,CAAC,IAAI,CAAC;IAC7B;IAEA,IAAI,CAACY,MAAM,GAAG,IAAIvB,UAAU,CAACX,IAAI,CAAC;IAClC,IAAI,CAACkC,MAAM,CAAChB,eAAe,GAAGA,eAAe;IAO7C,IAAImB,gBAAgB,IAAIA,gBAAgB,CAACrC,IAAI,IAAI,OAAOqC,gBAAgB,CAAC9B,KAAK,KAAK,UAAU,EAAE;MAC7F,MAAM+B,QAAQ,GAAGD,gBAAgB,CAAC9B,KAAK,CAAC,CAAC,CAAC;MAC1C+B,QAAQ,CAAChC,SAAS,GAAG,IAAI;MACzB,IAAI,CAAC4B,MAAM,CAACjB,SAAS,CAACU,IAAI,CAACW,QAAQ,CAAC;IACtC;IAEA,IAAI,CAACL,OAAO,CAACN,IAAI,CAAC,IAAI,CAACO,MAAM,CAAC;EAChC;EAEAK,QAAQA,CAAA,EAAG;IACT,IAAI,IAAI,CAACL,MAAM,IAAI,OAAO,IAAI,CAACA,MAAM,CAACZ,SAAS,KAAK,UAAU,EAAE;MAC9D,IAAI,CAACY,MAAM,CAACZ,SAAS,CAAC,IAAI,CAAC;IAC7B;EACF;EAEAkB,gBAAgBA,CAACC,KAAK,EAAEC,GAAG,EAAE;IAC3B,MAAM3C,KAAK,GAAG4C,QAAQ,CAACF,KAAK,CAAC;IAC7B,OAAO,CAAC1C,KAAK,IAAI,CAAC,GAAGA,KAAK,GAAG,CAAC,GAAGA,KAAK,GAAG2C,GAAG,GAAG,CAAC,IAAI,CAAC;EACvD;EAEAE,gBAAgBA,CAACH,KAAK,EAAEC,GAAG,EAAE;IAC3B,MAAM3C,KAAK,GAAG4C,QAAQ,CAACF,KAAK,CAAC;IAC7B,OAAO,CAAC1C,KAAK,IAAI,CAAC,GAAGA,KAAK,GAAG,CAAC,GAAGA,KAAK,GAAG2C,GAAG,GAAG,CAAC,IAAI,CAAC;EACvD;EAEAG,YAAYA,CAACJ,KAAK,EAAEC,GAAG,EAAE;IACvB,MAAM3C,KAAK,GAAG4C,QAAQ,CAACF,KAAK,CAAC;IAC7B,OAAO,CAAC1C,KAAK,IAAI,CAAC,GAAGA,KAAK,GAAG,CAAC,GAAGA,KAAK,GAAG2C,GAAG,GAAG,CAAC,IAAI,CAAC;EACvD;EAEAI,SAASA,CAACC,CAAC,EAAEC,CAAC,EAAEC,CAAC,EAAE;IACjB,MAAMC,GAAG,GAAG,IAAI,CAACrC,QAAQ;IACzB,MAAMsC,GAAG,GAAG,IAAI,CAACjB,MAAM,CAACtB,QAAQ,CAACC,QAAQ;IAEzCsC,GAAG,CAACxB,IAAI,CAACuB,GAAG,CAACH,CAAC,GAAG,CAAC,CAAC,EAAEG,GAAG,CAACH,CAAC,GAAG,CAAC,CAAC,EAAEG,GAAG,CAACH,CAAC,GAAG,CAAC,CAAC,CAAC;IAC5CI,GAAG,CAACxB,IAAI,CAACuB,GAAG,CAACF,CAAC,GAAG,CAAC,CAAC,EAAEE,GAAG,CAACF,CAAC,GAAG,CAAC,CAAC,EAAEE,GAAG,CAACF,CAAC,GAAG,CAAC,CAAC,CAAC;IAC5CG,GAAG,CAACxB,IAAI,CAACuB,GAAG,CAACD,CAAC,GAAG,CAAC,CAAC,EAAEC,GAAG,CAACD,CAAC,GAAG,CAAC,CAAC,EAAEC,GAAG,CAACD,CAAC,GAAG,CAAC,CAAC,CAAC;EAC9C;EAEAG,cAAcA,CAACL,CAAC,EAAE;IAChB,MAAMG,GAAG,GAAG,IAAI,CAACrC,QAAQ;IACzB,MAAMsC,GAAG,GAAG,IAAI,CAACjB,MAAM,CAACtB,QAAQ,CAACC,QAAQ;IAEzCsC,GAAG,CAACxB,IAAI,CAACuB,GAAG,CAACH,CAAC,GAAG,CAAC,CAAC,EAAEG,GAAG,CAACH,CAAC,GAAG,CAAC,CAAC,EAAEG,GAAG,CAACH,CAAC,GAAG,CAAC,CAAC,CAAC;EAC9C;EAEAM,aAAaA,CAACN,CAAC,EAAE;IACf,MAAMG,GAAG,GAAG,IAAI,CAACrC,QAAQ;IACzB,MAAMsC,GAAG,GAAG,IAAI,CAACjB,MAAM,CAACtB,QAAQ,CAACC,QAAQ;IAEzCsC,GAAG,CAACxB,IAAI,CAACuB,GAAG,CAACH,CAAC,GAAG,CAAC,CAAC,EAAEG,GAAG,CAACH,CAAC,GAAG,CAAC,CAAC,EAAEG,GAAG,CAACH,CAAC,GAAG,CAAC,CAAC,CAAC;EAC9C;EAEAO,SAASA,CAACP,CAAC,EAAEC,CAAC,EAAEC,CAAC,EAAE;IACjB,MAAMC,GAAG,GAAG,IAAI,CAACpC,OAAO;IACxB,MAAMqC,GAAG,GAAG,IAAI,CAACjB,MAAM,CAACtB,QAAQ,CAACE,OAAO;IAExCqC,GAAG,CAACxB,IAAI,CAACuB,GAAG,CAACH,CAAC,GAAG,CAAC,CAAC,EAAEG,GAAG,CAACH,CAAC,GAAG,CAAC,CAAC,EAAEG,GAAG,CAACH,CAAC,GAAG,CAAC,CAAC,CAAC;IAC5CI,GAAG,CAACxB,IAAI,CAACuB,GAAG,CAACF,CAAC,GAAG,CAAC,CAAC,EAAEE,GAAG,CAACF,CAAC,GAAG,CAAC,CAAC,EAAEE,GAAG,CAACF,CAAC,GAAG,CAAC,CAAC,CAAC;IAC5CG,GAAG,CAACxB,IAAI,CAACuB,GAAG,CAACD,CAAC,GAAG,CAAC,CAAC,EAAEC,GAAG,CAACD,CAAC,GAAG,CAAC,CAAC,EAAEC,GAAG,CAACD,CAAC,GAAG,CAAC,CAAC,CAAC;EAC9C;EAEAM,QAAQA,CAACR,CAAC,EAAEC,CAAC,EAAEC,CAAC,EAAE;IAChB,MAAMC,GAAG,GAAG,IAAI,CAACnC,MAAM;IACvB,MAAMoC,GAAG,GAAG,IAAI,CAACjB,MAAM,CAACtB,QAAQ,CAACG,MAAM;IAEvCoC,GAAG,CAACxB,IAAI,CAACuB,GAAG,CAACH,CAAC,GAAG,CAAC,CAAC,EAAEG,GAAG,CAACH,CAAC,GAAG,CAAC,CAAC,EAAEG,GAAG,CAACH,CAAC,GAAG,CAAC,CAAC,CAAC;IAC5CI,GAAG,CAACxB,IAAI,CAACuB,GAAG,CAACF,CAAC,GAAG,CAAC,CAAC,EAAEE,GAAG,CAACF,CAAC,GAAG,CAAC,CAAC,EAAEE,GAAG,CAACF,CAAC,GAAG,CAAC,CAAC,CAAC;IAC5CG,GAAG,CAACxB,IAAI,CAACuB,GAAG,CAACD,CAAC,GAAG,CAAC,CAAC,EAAEC,GAAG,CAACD,CAAC,GAAG,CAAC,CAAC,EAAEC,GAAG,CAACD,CAAC,GAAG,CAAC,CAAC,CAAC;EAC9C;EAEAO,KAAKA,CAACT,CAAC,EAAEC,CAAC,EAAEC,CAAC,EAAE;IACb,MAAMC,GAAG,GAAG,IAAI,CAAClC,GAAG;IACpB,MAAMmC,GAAG,GAAG,IAAI,CAACjB,MAAM,CAACtB,QAAQ,CAACI,GAAG;IAEpCmC,GAAG,CAACxB,IAAI,CAACuB,GAAG,CAACH,CAAC,GAAG,CAAC,CAAC,EAAEG,GAAG,CAACH,CAAC,GAAG,CAAC,CAAC,CAAC;IAChCI,GAAG,CAACxB,IAAI,CAACuB,GAAG,CAACF,CAAC,GAAG,CAAC,CAAC,EAAEE,GAAG,CAACF,CAAC,GAAG,CAAC,CAAC,CAAC;IAChCG,GAAG,CAACxB,IAAI,CAACuB,GAAG,CAACD,CAAC,GAAG,CAAC,CAAC,EAAEC,GAAG,CAACD,CAAC,GAAG,CAAC,CAAC,CAAC;EAClC;EAEAQ,SAASA,CAACV,CAAC,EAAE;IACX,MAAMG,GAAG,GAAG,IAAI,CAAClC,GAAG;IACpB,MAAMmC,GAAG,GAAG,IAAI,CAACjB,MAAM,CAACtB,QAAQ,CAACI,GAAG;IAEpCmC,GAAG,CAACxB,IAAI,CAACuB,GAAG,CAACH,CAAC,GAAG,CAAC,CAAC,EAAEG,GAAG,CAACH,CAAC,GAAG,CAAC,CAAC,CAAC;EAClC;EAGAW,OAAOA,CAACX,CAAC,EAAEC,CAAC,EAAEC,CAAC,EAAEU,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAE;IACvC,MAAMC,IAAI,GAAG,IAAI,CAACpD,QAAQ,CAACJ,MAAM;IAEjC,IAAIyD,EAAE,GAAG,IAAI,CAAC1B,gBAAgB,CAACO,CAAC,EAAEkB,IAAI,CAAC;IACvC,IAAIE,EAAE,GAAG,IAAI,CAAC3B,gBAAgB,CAACQ,CAAC,EAAEiB,IAAI,CAAC;IACvC,IAAIG,EAAE,GAAG,IAAI,CAAC5B,gBAAgB,CAACS,CAAC,EAAEgB,IAAI,CAAC;IAEvC,IAAI,CAACnB,SAAS,CAACoB,EAAE,EAAEC,EAAE,EAAEC,EAAE,CAAC;IAE1B,IAAIT,EAAE,KAAKjD,SAAS,IAAIiD,EAAE,KAAK,EAAE,EAAE;MACjC,MAAMU,KAAK,GAAG,IAAI,CAACrD,GAAG,CAACP,MAAM;MAC7ByD,EAAE,GAAG,IAAI,CAACrB,YAAY,CAACc,EAAE,EAAEU,KAAK,CAAC;MACjCF,EAAE,GAAG,IAAI,CAACtB,YAAY,CAACe,EAAE,EAAES,KAAK,CAAC;MACjCD,EAAE,GAAG,IAAI,CAACvB,YAAY,CAACgB,EAAE,EAAEQ,KAAK,CAAC;MACjC,IAAI,CAACb,KAAK,CAACU,EAAE,EAAEC,EAAE,EAAEC,EAAE,CAAC;IACxB;IAEA,IAAIN,EAAE,KAAKpD,SAAS,IAAIoD,EAAE,KAAK,EAAE,EAAE;MAEjC,MAAMQ,IAAI,GAAG,IAAI,CAACxD,OAAO,CAACL,MAAM;MAChCyD,EAAE,GAAG,IAAI,CAACtB,gBAAgB,CAACkB,EAAE,EAAEQ,IAAI,CAAC;MAEpCH,EAAE,GAAGL,EAAE,KAAKC,EAAE,GAAGG,EAAE,GAAG,IAAI,CAACtB,gBAAgB,CAACmB,EAAE,EAAEO,IAAI,CAAC;MACrDF,EAAE,GAAGN,EAAE,KAAKE,EAAE,GAAGE,EAAE,GAAG,IAAI,CAACtB,gBAAgB,CAACoB,EAAE,EAAEM,IAAI,CAAC;MAErD,IAAI,CAAChB,SAAS,CAACY,EAAE,EAAEC,EAAE,EAAEC,EAAE,CAAC;IAC5B;IAEA,IAAI,IAAI,CAACrD,MAAM,CAACN,MAAM,GAAG,CAAC,EAAE;MAC1B,IAAI,CAAC8C,QAAQ,CAACW,EAAE,EAAEC,EAAE,EAAEC,EAAE,CAAC;IAC3B;EACF;EAEAG,gBAAgBA,CAAC1D,QAAQ,EAAE;IACzB,IAAI,CAACqB,MAAM,CAACtB,QAAQ,CAAC4D,IAAI,GAAG,QAAQ;IAEpC,MAAMP,IAAI,GAAG,IAAI,CAACpD,QAAQ,CAACJ,MAAM;IAEjC,KAAK,MAAMgE,MAAM,IAAI5D,QAAQ,EAAE;MAC7B,IAAI,CAACuC,cAAc,CAAC,IAAI,CAACZ,gBAAgB,CAACiC,MAAM,EAAER,IAAI,CAAC,CAAC;IAC1D;EACF;EAEAS,eAAeA,CAAC7D,QAAQ,EAAEG,GAAG,EAAE;IAC7B,IAAI,CAACkB,MAAM,CAACtB,QAAQ,CAAC4D,IAAI,GAAG,MAAM;IAElC,MAAMP,IAAI,GAAG,IAAI,CAACpD,QAAQ,CAACJ,MAAM;IACjC,MAAM4D,KAAK,GAAG,IAAI,CAACrD,GAAG,CAACP,MAAM;IAE7B,KAAK,MAAMgE,MAAM,IAAI5D,QAAQ,EAAE;MAC7B,IAAI,CAACwC,aAAa,CAAC,IAAI,CAACb,gBAAgB,CAACiC,MAAM,EAAER,IAAI,CAAC,CAAC;IACzD;IAEA,KAAK,MAAMU,EAAE,IAAI3D,GAAG,EAAE;MACpB,IAAI,CAACyC,SAAS,CAAC,IAAI,CAACZ,YAAY,CAAC8B,EAAE,EAAEN,KAAK,CAAC,CAAC;IAC9C;EACF;AACF;AAGA,OAAO,SAASO,cAAcA,CAACC,IAAI,EAAE;EACnC,MAAMC,KAAK,GAAG,IAAI9C,WAAW,CAAC,CAAC;EAE/B,IAAI6C,IAAI,CAACE,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,EAAE;IAE/BF,IAAI,GAAGA,IAAI,CAACG,OAAO,CAAC,OAAO,EAAE,IAAI,CAAC;EACpC;EAEA,IAAIH,IAAI,CAACE,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,EAAE;IAE/BF,IAAI,GAAGA,IAAI,CAACG,OAAO,CAAC,OAAO,EAAE,EAAE,CAAC;EAClC;EAEA,MAAMC,KAAK,GAAGJ,IAAI,CAACK,KAAK,CAAC,IAAI,CAAC;EAC9B,IAAIC,IAAI,GAAG,EAAE;EACb,IAAIC,aAAa,GAAG,EAAE;EACtB,IAAIC,UAAU,GAAG,CAAC;EAClB,IAAIC,MAAM,GAAG,EAAE;EAGf,MAAMC,QAAQ,GAAG,OAAO,EAAE,CAACA,QAAQ,KAAK,UAAU;EAGlD,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEC,CAAC,GAAGR,KAAK,CAACxE,MAAM,EAAE+E,CAAC,GAAGC,CAAC,EAAED,CAAC,EAAE,EAAE;IAC5CL,IAAI,GAAGF,KAAK,CAACO,CAAC,CAAC;IACfL,IAAI,GAAGI,QAAQ,GAAGJ,IAAI,CAACI,QAAQ,CAAC,CAAC,GAAGJ,IAAI,CAACO,IAAI,CAAC,CAAC;IAC/CL,UAAU,GAAGF,IAAI,CAAC1E,MAAM;IAExB,IAAI4E,UAAU,KAAK,CAAC,EAAE;IAEtBD,aAAa,GAAGD,IAAI,CAACQ,MAAM,CAAC,CAAC,CAAC;IAG9B,IAAIP,aAAa,KAAK,GAAG,EAAE;IAE3B,IAAIA,aAAa,KAAK,GAAG,EAAE;MACzB,MAAMQ,IAAI,GAAGT,IAAI,CAACD,KAAK,CAAC,KAAK,CAAC;MAE9B,QAAQU,IAAI,CAAC,CAAC,CAAC;QACb,KAAK,GAAG;UACNd,KAAK,CAACjE,QAAQ,CAACc,IAAI,CAACkE,UAAU,CAACD,IAAI,CAAC,CAAC,CAAC,CAAC,EAAEC,UAAU,CAACD,IAAI,CAAC,CAAC,CAAC,CAAC,EAAEC,UAAU,CAACD,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;UAClF,IAAIA,IAAI,CAACnF,MAAM,KAAK,CAAC,EAAE;YACrBqE,KAAK,CAAC/D,MAAM,CAACY,IAAI,CAACkE,UAAU,CAACD,IAAI,CAAC,CAAC,CAAC,CAAC,EAAEC,UAAU,CAACD,IAAI,CAAC,CAAC,CAAC,CAAC,EAAEC,UAAU,CAACD,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;UAClF;UACA;QACF,KAAK,IAAI;UACPd,KAAK,CAAChE,OAAO,CAACa,IAAI,CAACkE,UAAU,CAACD,IAAI,CAAC,CAAC,CAAC,CAAC,EAAEC,UAAU,CAACD,IAAI,CAAC,CAAC,CAAC,CAAC,EAAEC,UAAU,CAACD,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;UACjF;QACF,KAAK,IAAI;UACPd,KAAK,CAAC9D,GAAG,CAACW,IAAI,CAACkE,UAAU,CAACD,IAAI,CAAC,CAAC,CAAC,CAAC,EAAEC,UAAU,CAACD,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;UACxD;QACF;MACF;IACF,CAAC,MAAM,IAAIR,aAAa,KAAK,GAAG,EAAE;MAChC,MAAMU,QAAQ,GAAGX,IAAI,CAACY,MAAM,CAAC,CAAC,CAAC,CAACL,IAAI,CAAC,CAAC;MACtC,MAAMM,UAAU,GAAGF,QAAQ,CAACZ,KAAK,CAAC,KAAK,CAAC;MACxC,MAAMe,YAAY,GAAG,EAAE;MAIvB,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEC,EAAE,GAAGH,UAAU,CAACvF,MAAM,EAAEyF,CAAC,GAAGC,EAAE,EAAED,CAAC,EAAE,EAAE;QACnD,MAAMzB,MAAM,GAAGuB,UAAU,CAACE,CAAC,CAAC;QAE5B,IAAIzB,MAAM,CAAChE,MAAM,GAAG,CAAC,EAAE;UACrB,MAAM2F,WAAW,GAAG3B,MAAM,CAACS,KAAK,CAAC,GAAG,CAAC;UACrCe,YAAY,CAACtE,IAAI,CAACyE,WAAW,CAAC;QAChC;MACF;MAIA,MAAMC,EAAE,GAAGJ,YAAY,CAAC,CAAC,CAAC;MAE1B,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEC,EAAE,GAAGF,YAAY,CAACxF,MAAM,GAAG,CAAC,EAAEyF,CAAC,GAAGC,EAAE,EAAED,CAAC,EAAE,EAAE;QACzD,MAAMI,EAAE,GAAGL,YAAY,CAACC,CAAC,CAAC;QAC1B,MAAMK,EAAE,GAAGN,YAAY,CAACC,CAAC,GAAG,CAAC,CAAC;QAE9BpB,KAAK,CAACpB,OAAO,CAAC2C,EAAE,CAAC,CAAC,CAAC,EAAEC,EAAE,CAAC,CAAC,CAAC,EAAEC,EAAE,CAAC,CAAC,CAAC,EAAEF,EAAE,CAAC,CAAC,CAAC,EAAEC,EAAE,CAAC,CAAC,CAAC,EAAEC,EAAE,CAAC,CAAC,CAAC,EAAEF,EAAE,CAAC,CAAC,CAAC,EAAEC,EAAE,CAAC,CAAC,CAAC,EAAEC,EAAE,CAAC,CAAC,CAAC,CAAC;MAC9E;IACF,CAAC,MAAM,IAAInB,aAAa,KAAK,GAAG,EAAE;MAChC,MAAMoB,SAAS,GAAGrB,IAAI,CAACsB,SAAS,CAAC,CAAC,CAAC,CAACf,IAAI,CAAC,CAAC,CAACR,KAAK,CAAC,GAAG,CAAC;MACrD,IAAIwB,YAAY;MAChB,MAAMC,OAAO,GAAG,EAAE;MAElB,IAAIxB,IAAI,CAACJ,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,EAAE;QAC5B2B,YAAY,GAAGF,SAAS;MAC1B,CAAC,MAAM;QACLE,YAAY,GAAG,EAAE;QACjB,KAAK,IAAIE,EAAE,GAAG,CAAC,EAAEC,IAAI,GAAGL,SAAS,CAAC/F,MAAM,EAAEmG,EAAE,GAAGC,IAAI,EAAED,EAAE,EAAE,EAAE;UACzD,MAAME,KAAK,GAAGN,SAAS,CAACI,EAAE,CAAC,CAAC1B,KAAK,CAAC,GAAG,CAAC;UAEtC,IAAI4B,KAAK,CAAC,CAAC,CAAC,KAAK,EAAE,EAAEJ,YAAY,CAAC/E,IAAI,CAACmF,KAAK,CAAC,CAAC,CAAC,CAAC;UAChD,IAAIA,KAAK,CAAC,CAAC,CAAC,KAAK,EAAE,EAAEH,OAAO,CAAChF,IAAI,CAACmF,KAAK,CAAC,CAAC,CAAC,CAAC;QAC7C;MACF;MACAhC,KAAK,CAACJ,eAAe,CAACgC,YAAY,EAAEC,OAAO,CAAC;IAC9C,CAAC,MAAM,IAAIvB,aAAa,KAAK,GAAG,EAAE;MAChC,MAAMU,QAAQ,GAAGX,IAAI,CAACY,MAAM,CAAC,CAAC,CAAC,CAACL,IAAI,CAAC,CAAC;MACtC,MAAMqB,SAAS,GAAGjB,QAAQ,CAACZ,KAAK,CAAC,GAAG,CAAC;MAErCJ,KAAK,CAACP,gBAAgB,CAACwC,SAAS,CAAC;IACnC,CAAC,MAAM,IAAI,CAACzB,MAAM,GAAG7F,SAAS,CAACuH,IAAI,CAAC7B,IAAI,CAAC,MAAM,IAAI,EAAE;MAOnD,MAAMnF,IAAI,GAAG,CAAC,GAAG,GAAGsF,MAAM,CAAC,CAAC,CAAC,CAACS,MAAM,CAAC,CAAC,CAAC,CAACL,IAAI,CAAC,CAAC,EAAEK,MAAM,CAAC,CAAC,CAAC;MAEzDjB,KAAK,CAAC1C,WAAW,CAACpC,IAAI,CAAC;IACzB,CAAC,MAAM,IAAIL,eAAe,CAACsH,IAAI,CAAC9B,IAAI,CAAC,EAAE;MAGrCL,KAAK,CAAC5C,MAAM,CAACf,aAAa,CAACgE,IAAI,CAACsB,SAAS,CAAC,CAAC,CAAC,CAACf,IAAI,CAAC,CAAC,EAAEZ,KAAK,CAAC3C,iBAAiB,CAAC;IAC/E,CAAC,MAAM,IAAIzC,WAAW,CAACuH,IAAI,CAAC9B,IAAI,CAAC,EAAE;MAGjCL,KAAK,CAAC3C,iBAAiB,CAACR,IAAI,CAACwD,IAAI,CAACsB,SAAS,CAAC,CAAC,CAAC,CAACf,IAAI,CAAC,CAAC,CAAC;IACxD,CAAC,MAAM,IAAIN,aAAa,KAAK,GAAG,EAAE;MAChCE,MAAM,GAAGH,IAAI,CAACD,KAAK,CAAC,GAAG,CAAC;MAsBxB,IAAII,MAAM,CAAC7E,MAAM,GAAG,CAAC,EAAE;QACrB,MAAMgC,KAAK,GAAG6C,MAAM,CAAC,CAAC,CAAC,CAACI,IAAI,CAAC,CAAC,CAACwB,WAAW,CAAC,CAAC;QAC5CpC,KAAK,CAAC5C,MAAM,CAAChC,MAAM,GAAGuC,KAAK,KAAK,GAAG,IAAIA,KAAK,KAAK,KAAK;MACxD,CAAC,MAAM;QAELqC,KAAK,CAAC5C,MAAM,CAAChC,MAAM,GAAG,IAAI;MAC5B;MACA,MAAMsB,QAAQ,GAAGsD,KAAK,CAAC5C,MAAM,CAACN,eAAe,CAAC,CAAC;MAC/C,IAAIJ,QAAQ,EAAEA,QAAQ,CAACtB,MAAM,GAAG4E,KAAK,CAAC5C,MAAM,CAAChC,MAAM;IACrD,CAAC,MAAM;MAEL,IAAIiF,IAAI,KAAK,IAAI,EAAE;MAEnB,MAAM,IAAIgC,KAAK,uBAAAC,MAAA,CAAsBjC,IAAI,OAAG,CAAC;IAC/C;EACF;EAEAL,KAAK,CAACvC,QAAQ,CAAC,CAAC;EAEhB,MAAM8E,MAAM,GAAG,EAAE;EACjB,MAAMpG,SAAS,GAAG,EAAE;EAEpB,KAAK,MAAMiB,MAAM,IAAI4C,KAAK,CAAC7C,OAAO,EAAE;IAClC,MAAM;MAACrB;IAAQ,CAAC,GAAGsB,MAAM;IAGzB,IAAItB,QAAQ,CAACC,QAAQ,CAACJ,MAAM,KAAK,CAAC,EAAE;IAEpC,MAAM6G,IAAI,GAAG;MACXC,MAAM,EAAE;QACNC,WAAW,EAAE5G,QAAQ,CAACC,QAAQ,CAACJ,MAAM,GAAG;MAC1C,CAAC;MACDgH,UAAU,EAAE,CAAC;IACf,CAAC;IAED,QAAQ7G,QAAQ,CAAC4D,IAAI;MACnB,KAAK,QAAQ;QACX8C,IAAI,CAACI,IAAI,GAAG,CAAC;QACb;MACF,KAAK,MAAM;QACTJ,IAAI,CAACI,IAAI,GAAG,CAAC;QACb;MACF;QACEJ,IAAI,CAACI,IAAI,GAAG,CAAC;QACb;IACJ;IAEAJ,IAAI,CAACG,UAAU,CAACE,QAAQ,GAAG;MAAClF,KAAK,EAAE,IAAImF,YAAY,CAAChH,QAAQ,CAACC,QAAQ,CAAC;MAAEgH,IAAI,EAAE;IAAC,CAAC;IAEhF,IAAIjH,QAAQ,CAACE,OAAO,CAACL,MAAM,GAAG,CAAC,EAAE;MAC/B6G,IAAI,CAACG,UAAU,CAACK,MAAM,GAAG;QAACrF,KAAK,EAAE,IAAImF,YAAY,CAAChH,QAAQ,CAACE,OAAO,CAAC;QAAE+G,IAAI,EAAE;MAAC,CAAC;IAC/E;IAEA,IAAIjH,QAAQ,CAACG,MAAM,CAACN,MAAM,GAAG,CAAC,EAAE;MAC9B6G,IAAI,CAACG,UAAU,CAACM,OAAO,GAAG;QAACtF,KAAK,EAAE,IAAImF,YAAY,CAAChH,QAAQ,CAACG,MAAM,CAAC;QAAE8G,IAAI,EAAE;MAAC,CAAC;IAC/E;IAEA,IAAIjH,QAAQ,CAACI,GAAG,CAACP,MAAM,GAAG,CAAC,EAAE;MAC3B6G,IAAI,CAACG,UAAU,CAACO,UAAU,GAAG;QAACvF,KAAK,EAAE,IAAImF,YAAY,CAAChH,QAAQ,CAACI,GAAG,CAAC;QAAE6G,IAAI,EAAE;MAAC,CAAC;IAC/E;IAGAP,IAAI,CAACrG,SAAS,GAAG,EAAE;IACnB,KAAK,MAAMgH,cAAc,IAAI/F,MAAM,CAACjB,SAAS,EAAE;MAE7C,MAAMiH,SAAS,GAAG;QAChBlI,IAAI,EAAEiI,cAAc,CAACjI,IAAI;QACzBmI,WAAW,EAAE,CAACF,cAAc,CAAC/H;MAC/B,CAAC;MACDoH,IAAI,CAACrG,SAAS,CAACU,IAAI,CAACuG,SAAS,CAAC;MAC9BjH,SAAS,CAACU,IAAI,CAACuG,SAAS,CAAC;IAC3B;IAEAZ,IAAI,CAACtH,IAAI,GAAGkC,MAAM,CAAClC,IAAI;IACvBqH,MAAM,CAAC1F,IAAI,CAAC2F,IAAI,CAAC;EACnB;EAEA,OAAO;IAACD,MAAM;IAAEpG;EAAS,CAAC;AAC5B"}