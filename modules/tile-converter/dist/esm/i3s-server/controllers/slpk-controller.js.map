{"version":3,"file":"slpk-controller.js","names":["require","fetchFile","parse","SLPKLoader","path","slpkArchive","loadArchive","fullLayerPath","arrayBuffer","I3S_LAYER_PATH","process","env","I3sLayerPath","FULL_LAYER_PATH","join","cwd","getFileByUrl","url","trimmedPath","exec","uncompressedFile","Buffer","from","slpk","pathMode","e","module","exports"],"sources":["../../../../src/i3s-server/controllers/slpk-controller.js"],"sourcesContent":["require('@loaders.gl/polyfills');\nconst {fetchFile, parse} = require('@loaders.gl/core');\nconst {SLPKLoader} = require('@loaders.gl/i3s');\nconst path = require('path');\n\nlet slpkArchive;\n\nconst loadArchive = async (fullLayerPath) => {\n  slpkArchive = await (await fetchFile(fullLayerPath)).arrayBuffer();\n};\n\nconst I3S_LAYER_PATH = process.env.I3sLayerPath || ''; // eslint-disable-line no-process-env, no-undef\nconst FULL_LAYER_PATH = path.join(process.cwd(), I3S_LAYER_PATH); // eslint-disable-line no-undef\n\nloadArchive(FULL_LAYER_PATH);\n\nasync function getFileByUrl(url) {\n  const trimmedPath = /^\\/?(.*)\\/?$/.exec(url);\n  let uncompressedFile;\n  if (trimmedPath) {\n    try {\n      uncompressedFile = Buffer.from(\n        await parse(slpkArchive, SLPKLoader, {\n          slpk: {\n            path: trimmedPath[1],\n            pathMode: 'http'\n          }\n        })\n      );\n    } catch (e) {}\n  }\n  return uncompressedFile;\n}\n\nmodule.exports = {\n  loadArchive,\n  getFileByUrl\n};\n"],"mappings":"AAAAA,OAAO,CAAC,uBAAuB,CAAC;AAChC,MAAM;EAACC,SAAS;EAAEC;AAAK,CAAC,GAAGF,OAAO,CAAC,kBAAkB,CAAC;AACtD,MAAM;EAACG;AAAU,CAAC,GAAGH,OAAO,CAAC,iBAAiB,CAAC;AAC/C,MAAMI,IAAI,GAAGJ,OAAO,CAAC,MAAM,CAAC;AAE5B,IAAIK,WAAW;AAEf,MAAMC,WAAW,GAAG,MAAOC,aAAa,IAAK;EAC3CF,WAAW,GAAG,MAAM,CAAC,MAAMJ,SAAS,CAACM,aAAa,CAAC,EAAEC,WAAW,CAAC,CAAC;AACpE,CAAC;AAED,MAAMC,cAAc,GAAGC,OAAO,CAACC,GAAG,CAACC,YAAY,IAAI,EAAE;AACrD,MAAMC,eAAe,GAAGT,IAAI,CAACU,IAAI,CAACJ,OAAO,CAACK,GAAG,CAAC,CAAC,EAAEN,cAAc,CAAC;AAEhEH,WAAW,CAACO,eAAe,CAAC;AAE5B,eAAeG,YAAYA,CAACC,GAAG,EAAE;EAC/B,MAAMC,WAAW,GAAG,cAAc,CAACC,IAAI,CAACF,GAAG,CAAC;EAC5C,IAAIG,gBAAgB;EACpB,IAAIF,WAAW,EAAE;IACf,IAAI;MACFE,gBAAgB,GAAGC,MAAM,CAACC,IAAI,CAC5B,MAAMpB,KAAK,CAACG,WAAW,EAAEF,UAAU,EAAE;QACnCoB,IAAI,EAAE;UACJnB,IAAI,EAAEc,WAAW,CAAC,CAAC,CAAC;UACpBM,QAAQ,EAAE;QACZ;MACF,CAAC,CACH,CAAC;IACH,CAAC,CAAC,OAAOC,CAAC,EAAE,CAAC;EACf;EACA,OAAOL,gBAAgB;AACzB;AAEAM,MAAM,CAACC,OAAO,GAAG;EACfrB,WAAW;EACXU;AACF,CAAC"}