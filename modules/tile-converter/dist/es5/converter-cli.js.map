{"version":3,"file":"converter-cli.js","names":["require","_path","_tileConverter","_depsInstaller","TILESET_TYPE","I3S","_3DTILES","main","_main","apply","arguments","_asyncToGenerator2","default","_regenerator","mark","_callee","_process$argv","args","validatedOptionsArr","options","depthInstaller","validatedOptions","wrap","_callee$","_context","prev","next","_toArray2","process","argv","slice","length","printHelp","validateOptionsWithEqual","parseOptions","installDependencies","DepsInstaller","install","abrupt","validateOptions","convert","stop","catch","error","console","log","exit","_x","_convert","_callee2","inputType","tiles3DConverter","converter","_callee2$","_context2","concat","toUpperCase","t0","Tiles3DConverter","inputUrl","tileset","outputPath","output","tilesetName","name","maxDepth","egmFilePath","egm","I3SConverter","slpk","sevenZipExe","token","draco","mergeMaterials","generateTextures","generateBoundingVolumes","validate","instantNodeWriting","mandatoryOptionsWithExceptions","exceptions","mandatoryOption","optionValue","isWrongInputType","Boolean","Object","values","includes","push","forEach","exeption","reduce","acc","curr","equalSignIndex","indexOf","beforeEqual","afterEqual","condition","startsWith","opts","join","cwd","arg","index","getStringValue","getURLValue","getBooleanValue","getIntegerValue","warn","value","replace","stringValue","result","Number","parseInt","isFinite","NaN","toLowerCase","trim"],"sources":["../../src/converter-cli.ts"],"sourcesContent":["/* eslint-disable no-console */\nimport '@loaders.gl/polyfills';\nimport {join} from 'path';\nimport {I3SConverter, Tiles3DConverter} from '@loaders.gl/tile-converter';\nimport {DepsInstaller} from './deps-installer/deps-installer';\n\ntype TileConversionOptions = {\n  /** \"I3S\" - for I3S to 3DTiles conversion, \"3DTILES\" for 3DTiles to I3S conversion */\n  inputType?: string;\n  /** \"tileset.json\" file (3DTiles) / \"http://..../SceneServer/layers/0\" resource (I3S) */\n  tileset?: string;\n  /** Tileset name. This option is used for naming in resulting json resouces and for resulting path/*.slpk file naming */\n  name?: string;\n  /** Output folder. This folder will be created by converter if doesn't exist. It is relative to the converter path.\n   * Default: \"data\" folder */\n  output: string;\n  /** Keep created 3DNodeIndexDocument files on disk instead of memory. This option reduce memory usage but decelerates conversion speed */\n  instantNodeWriting: boolean;\n  /** Try to merge similar materials to be able to merge meshes into one node (I3S to 3DTiles conversion only) */\n  mergeMaterials: boolean;\n  /** 3DTiles->I3S only. location of 7z.exe archiver to create slpk on Windows OS, default: \"C:\\Program Files\\7-Zip\\7z.exe\" */\n  sevenZipExe: string;\n  /** location of the Earth Gravity Model (*.pgm) file to convert heights from ellipsoidal to gravity-related format,\n   * default: \"./deps/egm2008-5.pgm\". A model file can be loaded from GeographicLib\n   * https://geographiclib.sourceforge.io/html/geoid.html */\n  egm: string;\n  /** 3DTile->I3S only. Token for Cesium ION tileset authentication. */\n  token?: string;\n  /** 3DTiles->I3S only. Enable draco compression for geometry. Default: true */\n  draco: boolean;\n  /** Run the script for installing dependencies. Run this options separate from others. Now \"*.pgm\" file installation is\n   * implemented */\n  installDependencies: boolean;\n  /** 3DTile->I3S only. Enable KTX2 textures generation if only one of (JPG, PNG) texture is provided or generate JPG texture\n   * if only KTX2 is provided */\n  generateTextures: boolean;\n  /** 3DTile->I3S only. Will generate obb and mbs bounding volumes from geometry */\n  generateBoundingVolumes: boolean;\n  /** Validate the dataset during conversion. Validation messages will be posted in the console output */\n  validate: boolean;\n  /** Maximal depth of the hierarchical tiles tree traversal, default: infinite */\n  maxDepth?: number;\n  /** 3DTiles->I3S only. Whether the converter generates *.slpk (Scene Layer Package) I3S output file */\n  slpk: boolean;\n};\n\n/* During validation we check that particular options are defined so they can't be undefined */\ntype ValidatedTileConversionOptions = TileConversionOptions & {\n  /** \"I3S\" - for I3S to 3DTiles conversion, \"3DTILES\" for 3DTiles to I3S conversion */\n  inputType: string;\n  /** \"tileset.json\" file (3DTiles) / \"http://..../SceneServer/layers/0\" resource (I3S) */\n  tileset: string;\n  /** Tileset name. This option is used for naming in resulting json resouces and for resulting path/*.slpk file naming */\n  name: string;\n};\n\nconst TILESET_TYPE = {\n  I3S: 'I3S',\n  _3DTILES: '3DTILES'\n};\n\n/**\n * CLI entry\n * @returns\n */\nasync function main() {\n  const [, , ...args] = process.argv;\n\n  if (args.length === 0) {\n    printHelp();\n  }\n\n  const validatedOptionsArr = validateOptionsWithEqual(args);\n\n  const options: TileConversionOptions = parseOptions(validatedOptionsArr);\n\n  if (options.installDependencies) {\n    const depthInstaller = new DepsInstaller();\n    depthInstaller.install('deps');\n    return;\n  }\n\n  const validatedOptions: ValidatedTileConversionOptions = validateOptions(options);\n\n  await convert(validatedOptions);\n}\n\nmain().catch((error) => {\n  console.log(error);\n  process.exit(1); // eslint-disable-line\n});\n\n/**\n * Output for `npx tile-converter --help`\n */\nfunction printHelp(): void {\n  console.log('cli: converter 3dTiles to I3S or I3S to 3dTiles...');\n  console.log(\n    '--install-dependencies [Run the script for installing dependencies. Run this options separate from others. Now \"*.pgm\" file installation is implemented]'\n  );\n  console.log(\n    '--max-depth [Maximal depth of hierarchical tiles tree traversal, default: infinite]'\n  );\n  console.log('--name [Tileset name]');\n  console.log('--output [Output folder, default: \"data\" folder]');\n  console.log(\n    '--instant-node-writing [Keep created 3DNodeIndexDocument files on disk instead of memory. This option reduce memory usage but decelerates conversion speed]'\n  );\n  console.log(\n    '--split-nodes [Prevent to merge similar materials that could lead to incorrect visualization (I3S to 3DTiles conversion only)]'\n  );\n  console.log('--slpk [Generate slpk (Scene Layer Packages) I3S output file]');\n  console.log(\n    '--tileset [tileset.json file (3DTiles) / http://..../SceneServer/layers/0 resource (I3S)]'\n  );\n  console.log('--input-type [tileset input type: I3S or 3DTILES]');\n  console.log(\n    '--7zExe [location of 7z.exe archiver to create slpk on Windows, default: \"C:\\\\Program Files\\\\7-Zip\\\\7z.exe\"]'\n  );\n  console.log(\n    '--egm [location of Earth Gravity Model *.pgm file to convert heights from ellipsoidal to gravity-related format. A model file can be loaded from GeographicLib https://geographiclib.sourceforge.io/html/geoid.html], default: \"./deps/egm2008-5.zip\"'\n  );\n  console.log('--token [Token for Cesium ION tilesets authentication]');\n  console.log('--no-draco [Disable draco compression for geometry]');\n  console.log(\n    '--generate-textures [Enable KTX2 textures generation if only one of (JPG, PNG) texture is provided or generate JPG texture if only KTX2 is provided]'\n  );\n  console.log(\n    '--generate-bounding-volumes [Will generate obb and mbs bounding volumes from geometry]'\n  );\n  console.log('--validate [Enable validation]');\n  process.exit(0); // eslint-disable-line\n}\n\n/**\n * Run conversion process\n * @param options validated tile-converter options\n */\nasync function convert(options: ValidatedTileConversionOptions) {\n  console.log(`------------------------------------------------`); // eslint-disable-line\n  console.log(`Starting conversion of ${options.inputType}`); // eslint-disable-line\n  console.log(`------------------------------------------------`); // eslint-disable-line\n  const inputType = options.inputType.toUpperCase();\n  switch (inputType) {\n    case TILESET_TYPE.I3S:\n      const tiles3DConverter = new Tiles3DConverter();\n      tiles3DConverter.convert({\n        inputUrl: options.tileset,\n        outputPath: options.output,\n        tilesetName: options.name,\n        maxDepth: options.maxDepth,\n        egmFilePath: options.egm\n      });\n      break;\n    case TILESET_TYPE._3DTILES:\n      const converter = new I3SConverter();\n      await converter.convert({\n        inputUrl: options.tileset,\n        outputPath: options.output,\n        tilesetName: options.name,\n        maxDepth: options.maxDepth,\n        slpk: options.slpk,\n        sevenZipExe: options.sevenZipExe,\n        egmFilePath: options.egm,\n        token: options.token,\n        draco: options.draco,\n        mergeMaterials: options.mergeMaterials,\n        generateTextures: options.generateTextures,\n        generateBoundingVolumes: options.generateBoundingVolumes,\n        validate: options.validate,\n        instantNodeWriting: options.instantNodeWriting\n      });\n      break;\n    default:\n      printHelp();\n  }\n}\n\n// OPTIONS\n/**\n * Validate input options of the CLI command\n * @param options - input options of the CLI command\n * @returns validated options\n */\nfunction validateOptions(options: TileConversionOptions): ValidatedTileConversionOptions {\n  const mandatoryOptionsWithExceptions: {\n    [key: string]: () => void;\n  } = {\n    name: () => console.log('Missed: --name [Tileset name]'),\n    output: () => console.log('Missed: --output [Output path name]'),\n    sevenZipExe: () => console.log('Missed: --7zExe [7z archiver executable path]'),\n    egm: () => console.log('Missed: --egm [*.pgm earth gravity model file path]'),\n    tileset: () => console.log('Missed: --tileset [tileset.json file]'),\n    inputType: () =>\n      console.log('Missed/Incorrect: --input-type [tileset input type: I3S or 3DTILES]')\n  };\n  const exceptions: (() => void)[] = [];\n  for (const mandatoryOption in mandatoryOptionsWithExceptions) {\n    const optionValue = options[mandatoryOption];\n    const isWrongInputType =\n      Boolean(optionValue) &&\n      mandatoryOption === 'inputType' &&\n      !Object.values(TILESET_TYPE).includes(optionValue.toUpperCase());\n\n    if (!optionValue || isWrongInputType) {\n      exceptions.push(mandatoryOptionsWithExceptions[mandatoryOption]);\n    }\n  }\n  if (exceptions.length) {\n    exceptions.forEach((exeption) => exeption());\n    process.exit(1);\n  }\n  return <ValidatedTileConversionOptions>options;\n}\n\nfunction validateOptionsWithEqual(args: string[]): string[] {\n  return args.reduce((acc: string[], curr) => {\n    const equalSignIndex = curr.indexOf('=');\n    const beforeEqual = curr.slice(0, equalSignIndex);\n    const afterEqual = curr.slice(equalSignIndex + 1, curr.length);\n    const condition = curr.includes('=') && curr.startsWith('--') && afterEqual;\n    if (condition) {\n      return acc.concat(beforeEqual, afterEqual);\n    }\n    return acc.concat(curr);\n  }, []);\n}\n\n/**\n * Parse option from the cli arguments array\n * @param args\n * @returns\n */\nfunction parseOptions(args: string[]): TileConversionOptions {\n  const opts: TileConversionOptions = {\n    output: 'data',\n    instantNodeWriting: false,\n    mergeMaterials: true,\n    sevenZipExe: 'C:\\\\Program Files\\\\7-Zip\\\\7z.exe',\n    egm: join(process.cwd(), 'deps', 'egm2008-5.pgm'),\n    draco: true,\n    installDependencies: false,\n    generateTextures: false,\n    generateBoundingVolumes: false,\n    validate: false,\n    slpk: false\n  };\n\n  // eslint-disable-next-line complexity\n  args.forEach((arg, index) => {\n    if (arg.indexOf('--') === 0) {\n      switch (arg) {\n        case '--input-type':\n          opts.inputType = getStringValue(index, args);\n          break;\n        case '--tileset':\n          opts.tileset = getURLValue(index, args);\n          break;\n        case '--name':\n          opts.name = getStringValue(index, args);\n          break;\n        case '--output':\n          opts.output = getStringValue(index, args);\n          break;\n        case '--instant-node-writing':\n          opts.instantNodeWriting = getBooleanValue(index, args);\n          break;\n        case '--split-nodes':\n          opts.mergeMaterials = getBooleanValue(index, args);\n          break;\n        case '--max-depth':\n          opts.maxDepth = getIntegerValue(index, args);\n          break;\n        case '--slpk':\n          opts.slpk = getBooleanValue(index, args);\n          break;\n        case '--7zExe':\n          opts.sevenZipExe = getStringValue(index, args);\n          break;\n        case '--egm':\n          opts.egm = getStringValue(index, args);\n          break;\n        case '--token':\n          opts.token = getStringValue(index, args);\n          break;\n        case '--no-draco':\n          opts.draco = getBooleanValue(index, args);\n          break;\n        case '--validate':\n          opts.validate = getBooleanValue(index, args);\n          break;\n        case '--install-dependencies':\n          opts.installDependencies = getBooleanValue(index, args);\n          break;\n        case '--generate-textures':\n          opts.generateTextures = getBooleanValue(index, args);\n          break;\n        case '--generate-bounding-volumes':\n          opts.generateBoundingVolumes = getBooleanValue(index, args);\n          break;\n        case '--help':\n          printHelp();\n          break;\n        default:\n          console.warn(`Unknown option ${arg}`);\n          process.exit(0); // eslint-disable-line\n      }\n    }\n  });\n  return opts;\n}\n\n/**\n * Get string option value from cli arguments\n * @param index - option's name index in the argument's array.\n *                The value of the option should be next to name of the option.\n * @param args - cli arguments array\n * @returns - string value of the option\n */\nfunction getStringValue(index: number, args: string[]): string {\n  if (index + 1 >= args.length) {\n    return '';\n  }\n  const value = args[index + 1];\n  if (value.indexOf('--') === 0) {\n    return '';\n  }\n  return value;\n}\n\n/**\n * Modyfy URL path to be compatible with fetch\n * @param index - option's name index in the argument's array.\n *                The value of the option should be next to name of the option.\n * @param args - cli arguments array\n * @returns - string value of the option\n */\nfunction getURLValue(index: number, args: string[]): string {\n  const value = getStringValue(index, args);\n  console.log(`Input tileset value: ${value}`);\n  console.log(`Modified tileset value: ${value.replace(/\\\\/g, '/')}`);\n  return value.replace(/\\\\/g, '/');\n}\n\n/**\n * Get integer option value from cli arguments\n * @param index - option's name index in the argument's array\n *                The value of the option should be next to name of the option.\n * @param args - cli arguments array\n * @returns - number value of the option\n */\nfunction getIntegerValue(index: number, args: string[]): number {\n  const stringValue: string = getStringValue(index, args);\n  const result: number = Number.parseInt(stringValue);\n  if (isFinite(result)) {\n    return result;\n  }\n  return NaN;\n}\n\nfunction getBooleanValue(index: number, args: string[]): boolean {\n  const stringValue: string = getStringValue(index, args).toLowerCase().trim();\n  if (['--no-draco', '--split-nodes'].includes(args[index]) && !stringValue) {\n    return false;\n  }\n  if (!stringValue || stringValue === 'true') {\n    return true;\n  }\n  return false;\n}\n"],"mappings":"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"}