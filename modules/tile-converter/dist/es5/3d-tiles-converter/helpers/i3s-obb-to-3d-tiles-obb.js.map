{"version":3,"file":"i3s-obb-to-3d-tiles-obb.js","names":["_core","require","_geospatial","_culling","i3sObbTo3dTilesObb","i3SObb","geoidHeightModel","tiles3DCenter","center","getHeight","cartesianCenter","Ellipsoid","WGS84","cartographicToCartesian","Vector3","tiles3DObb","OrientedBoundingBox","fromCenterHalfSizeQuaternion","halfSize","quaternion","concat","_toConsumableArray2","default","halfAxes","toArray"],"sources":["../../../../src/3d-tiles-converter/helpers/i3s-obb-to-3d-tiles-obb.ts"],"sourcesContent":["import {Vector3} from '@math.gl/core';\nimport {Ellipsoid} from '@math.gl/geospatial';\nimport {OrientedBoundingBox} from '@math.gl/culling';\n// @ts-expect-error\nimport {GeoidHeightModel} from '@loaders.gl/tile-converter/lib/geoid-height-model';\n\n/**\n * Convert quaternion-based OBB to half-axes-based OBB\n * @param i3SObb quaternion based OBB\n * @param geoidHeightModel the Earth Gravity Model instance\n * @returns number[12] 3DTiles OBB https://github.com/CesiumGS/3d-tiles/tree/master/specification#box\n */\nexport function i3sObbTo3dTilesObb(\n  i3SObb: {\n    center: number[];\n    halfSize: number[];\n    quaternion: number[];\n  },\n  geoidHeightModel: GeoidHeightModel\n): number[] {\n  const tiles3DCenter = [\n    i3SObb.center[0],\n    i3SObb.center[1],\n    i3SObb.center[2] + geoidHeightModel.getHeight(i3SObb.center[1], i3SObb.center[0])\n  ];\n  const cartesianCenter = Ellipsoid.WGS84.cartographicToCartesian(tiles3DCenter, new Vector3());\n  const tiles3DObb = new OrientedBoundingBox().fromCenterHalfSizeQuaternion(\n    cartesianCenter,\n    i3SObb.halfSize,\n    i3SObb.quaternion\n  );\n  return [...tiles3DObb.center, ...tiles3DObb.halfAxes.toArray()];\n}\n"],"mappings":";;;;;;;;AAAA,IAAAA,KAAA,GAAAC,OAAA;AACA,IAAAC,WAAA,GAAAD,OAAA;AACA,IAAAE,QAAA,GAAAF,OAAA;AAUO,SAASG,kBAAkBA,CAChCC,MAIC,EACDC,gBAAkC,EACxB;EACV,IAAMC,aAAa,GAAG,CACpBF,MAAM,CAACG,MAAM,CAAC,CAAC,CAAC,EAChBH,MAAM,CAACG,MAAM,CAAC,CAAC,CAAC,EAChBH,MAAM,CAACG,MAAM,CAAC,CAAC,CAAC,GAAGF,gBAAgB,CAACG,SAAS,CAACJ,MAAM,CAACG,MAAM,CAAC,CAAC,CAAC,EAAEH,MAAM,CAACG,MAAM,CAAC,CAAC,CAAC,CAAC,CAClF;EACD,IAAME,eAAe,GAAGC,qBAAS,CAACC,KAAK,CAACC,uBAAuB,CAACN,aAAa,EAAE,IAAIO,aAAO,CAAC,CAAC,CAAC;EAC7F,IAAMC,UAAU,GAAG,IAAIC,4BAAmB,CAAC,CAAC,CAACC,4BAA4B,CACvEP,eAAe,EACfL,MAAM,CAACa,QAAQ,EACfb,MAAM,CAACc,UACT,CAAC;EACD,UAAAC,MAAA,KAAAC,mBAAA,CAAAC,OAAA,EAAWP,UAAU,CAACP,MAAM,OAAAa,mBAAA,CAAAC,OAAA,EAAKP,UAAU,CAACQ,QAAQ,CAACC,OAAO,CAAC,CAAC;AAChE"}