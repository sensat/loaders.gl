{"version":3,"file":"hash.js","names":["concatenateArrayBuffersAsync","Hash","constructor","options","arguments","length","undefined","_defineProperty","hashBatches","bind","preload","asyncIterator","_this$options$crypto","_this$options$crypto$","arrayBuffers","arrayBuffer","push","output","concatenate","hash","crypto","onEnd","call"],"sources":["../../../src/lib/hash.ts"],"sourcesContent":["// Hash\nimport {concatenateArrayBuffersAsync} from '@loaders.gl/loader-utils';\n\ntype HashOptions = {\n  modules?: {[moduleName: string]: any};\n  crypto?: {\n    onEnd?: (result: {hash: string}) => any;\n  };\n};\n\n/** Abstract hash base class */\nexport abstract class Hash {\n  abstract readonly name: string;\n  abstract readonly options: HashOptions;\n\n  constructor(options: HashOptions = {}) {\n    this.hashBatches = this.hashBatches.bind(this);\n  }\n\n  async preload(): Promise<void> {\n    return;\n  }\n\n  abstract hash(arrayBuffer: ArrayBuffer): Promise<string>;\n\n  async *hashBatches(\n    asyncIterator: AsyncIterable<ArrayBuffer> | Iterable<ArrayBuffer>\n  ): AsyncIterable<ArrayBuffer> {\n    const arrayBuffers: ArrayBuffer[] = [];\n    for await (const arrayBuffer of asyncIterator) {\n      arrayBuffers.push(arrayBuffer);\n      yield arrayBuffer;\n    }\n    const output = await this.concatenate(arrayBuffers);\n    const hash = await this.hash(output);\n    this.options.crypto?.onEnd?.({hash});\n  }\n\n  // HELPERS\n\n  protected async concatenate(asyncIterator): Promise<ArrayBuffer> {\n    return await concatenateArrayBuffersAsync(asyncIterator);\n  }\n}\n"],"mappings":";AACA,SAAQA,4BAA4B,QAAO,0BAA0B;AAUrE,OAAO,MAAeC,IAAI,CAAC;EAIzBC,WAAWA,CAAA,EAA4B;IAAA,IAA3BC,OAAoB,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,CAAC,CAAC;IAAAG,eAAA;IAAAA,eAAA;IACnC,IAAI,CAACC,WAAW,GAAG,IAAI,CAACA,WAAW,CAACC,IAAI,CAAC,IAAI,CAAC;EAChD;EAEA,MAAMC,OAAOA,CAAA,EAAkB;IAC7B;EACF;EAIA,OAAOF,WAAWA,CAChBG,aAAiE,EACrC;IAAA,IAAAC,oBAAA,EAAAC,qBAAA;IAC5B,MAAMC,YAA2B,GAAG,EAAE;IACtC,WAAW,MAAMC,WAAW,IAAIJ,aAAa,EAAE;MAC7CG,YAAY,CAACE,IAAI,CAACD,WAAW,CAAC;MAC9B,MAAMA,WAAW;IACnB;IACA,MAAME,MAAM,GAAG,MAAM,IAAI,CAACC,WAAW,CAACJ,YAAY,CAAC;IACnD,MAAMK,IAAI,GAAG,MAAM,IAAI,CAACA,IAAI,CAACF,MAAM,CAAC;IACpC,CAAAL,oBAAA,OAAI,CAACT,OAAO,CAACiB,MAAM,cAAAR,oBAAA,wBAAAC,qBAAA,GAAnBD,oBAAA,CAAqBS,KAAK,cAAAR,qBAAA,uBAA1BA,qBAAA,CAAAS,IAAA,CAAAV,oBAAA,EAA6B;MAACO;IAAI,CAAC,CAAC;EACtC;EAIA,MAAgBD,WAAWA,CAACP,aAAa,EAAwB;IAC/D,OAAO,MAAMX,4BAA4B,CAACW,aAAa,CAAC;EAC1D;AACF"}