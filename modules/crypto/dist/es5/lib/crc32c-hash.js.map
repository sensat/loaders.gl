{"version":3,"file":"crc32c-hash.js","names":["_hash2","require","_crc32c","_interopRequireDefault","_digestUtils","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty2","default","getOwnPropertyDescriptors","defineProperties","defineProperty","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf2","result","NewTarget","constructor","Reflect","construct","_possibleConstructorReturn2","sham","Proxy","Boolean","prototype","valueOf","call","e","_asyncIterator","iterable","method","async","sync","retry","Symbol","asyncIterator","iterator","AsyncFromSyncIterator","TypeError","s","AsyncFromSyncIteratorContinuation","r","Promise","reject","done","resolve","value","then","n","next","return","_return","ret","throw","_throw","thr","CRC32CHash","_Hash","_inherits2","_super","_this2","options","undefined","_classCallCheck2","_assertThisInitialized2","crypto","_hash","CRC32C","_createClass2","_asyncToGenerator2","_regenerator","mark","_callee","input","wrap","_callee$","_context","prev","abrupt","hashSync","stop","hash","_x","update","hashValue","finalize","hex","toHex","hexToBase64","hashBatches","_this","_wrapAsyncGenerator2","_callee2","_this$options$crypto","_this$options$crypto$","_iteratorAbruptCompletion","_didIteratorError","_iteratorError","_iterator","_step","chunk","_callee2$","_context2","_awaitAsyncGenerator2","sent","t0","finish","onEnd","Hash","exports"],"sources":["../../../src/lib/crc32c-hash.ts"],"sourcesContent":["// CRC32c\nimport {Hash} from './hash';\nimport CRC32C from './algorithms/crc32c';\nimport {toHex, hexToBase64} from './utils/digest-utils';\n\n/**\n * A transform that calculates CRC32c Hash\n */\nexport class CRC32CHash extends Hash {\n  readonly name = 'crc32c';\n\n  options;\n  private _hash: CRC32C;\n\n  /**\n   * Atomic hash calculation\n   * @returns base64 encoded hash\n   */\n  constructor(options = {}) {\n    super();\n    this.options = {crypto: {}, ...options};\n    this._hash = new CRC32C(options);\n  }\n\n  /**\n   * Atomic hash calculation\n   * @returns base64 encoded hash\n   */\n  async hash(input: ArrayBuffer): Promise<string> {\n    return this.hashSync(input);\n  }\n\n  hashSync(input: ArrayBuffer): string {\n    this._hash.update(input);\n    const hashValue = this._hash.finalize();\n    const hex = toHex(hashValue);\n    const hash = hexToBase64(hex);\n    return hash;\n  }\n\n  // runInBatches inherited\n\n  async *hashBatches(\n    asyncIterator: AsyncIterable<ArrayBuffer> | Iterable<ArrayBuffer>\n  ): AsyncIterable<ArrayBuffer> {\n    for await (const chunk of asyncIterator) {\n      this._hash.update(chunk);\n      yield chunk;\n    }\n    const hashValue = this._hash.finalize();\n    const hex = toHex(hashValue);\n    const hash = hexToBase64(hex);\n    this.options.crypto?.onEnd?.({hash});\n  }\n}\n"],"mappings":"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"}