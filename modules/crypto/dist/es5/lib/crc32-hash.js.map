{"version":3,"file":"crc32-hash.js","names":["_hash2","require","_crc","_interopRequireDefault","_digestUtils","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty2","default","getOwnPropertyDescriptors","defineProperties","defineProperty","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf2","result","NewTarget","constructor","Reflect","construct","_possibleConstructorReturn2","sham","Proxy","Boolean","prototype","valueOf","call","e","_asyncIterator","iterable","method","async","sync","retry","Symbol","asyncIterator","iterator","AsyncFromSyncIterator","TypeError","s","AsyncFromSyncIteratorContinuation","r","Promise","reject","done","resolve","value","then","n","next","return","_return","ret","throw","_throw","thr","CRC32Hash","_Hash","_inherits2","_super","_this2","options","undefined","_classCallCheck2","_assertThisInitialized2","crypto","_hash","CRC32","hashBatches","bind","_createClass2","_asyncToGenerator2","_regenerator","mark","_callee","input","wrap","_callee$","_context","prev","abrupt","hashSync","stop","hash","_x","update","hashValue","finalize","hex","toHex","hexToBase64","_this","_wrapAsyncGenerator2","_callee2","_this$options$crypto","_this$options$crypto$","_iteratorAbruptCompletion","_didIteratorError","_iteratorError","_iterator","_step","chunk","_callee2$","_context2","_awaitAsyncGenerator2","sent","t0","finish","onEnd","Hash","exports"],"sources":["../../../src/lib/crc32-hash.ts"],"sourcesContent":["// CRC32\nimport {Hash} from './hash';\nimport CRC32 from './algorithms/crc32';\nimport {toHex, hexToBase64} from './utils/digest-utils';\n\n/**\n * Calculates CRC32 Cryptographic Hash\n */\nexport class CRC32Hash extends Hash {\n  readonly name = 'crc32';\n\n  options;\n  private _hash: CRC32;\n\n  constructor(options = {}) {\n    super();\n    this.options = {crypto: {}, ...options};\n    this._hash = new CRC32();\n    this.hashBatches = this.hashBatches.bind(this);\n  }\n\n  /**\n   * Atomic hash calculation\n   * @returns base64 encoded hash\n   */\n  async hash(input: ArrayBuffer): Promise<string> {\n    return this.hashSync(input);\n  }\n\n  hashSync(input: ArrayBuffer): string {\n    this._hash.update(input);\n    const hashValue = this._hash.finalize();\n    const hex = toHex(hashValue);\n    const hash = hexToBase64(hex);\n    return hash;\n  }\n\n  async *hashBatches(\n    asyncIterator: AsyncIterable<ArrayBuffer> | Iterable<ArrayBuffer>\n  ): AsyncIterable<ArrayBuffer> {\n    for await (const chunk of asyncIterator) {\n      this._hash.update(chunk);\n      yield chunk;\n    }\n    const hashValue = this._hash.finalize();\n    const hex = toHex(hashValue);\n    const hash = hexToBase64(hex);\n    this.options.crypto?.onEnd?.({hash});\n  }\n}\n"],"mappings":"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"}