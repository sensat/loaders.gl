{"version":3,"file":"hash.js","names":["_loaderUtils","require","_asyncIterator","iterable","method","async","sync","retry","Symbol","asyncIterator","iterator","call","AsyncFromSyncIterator","TypeError","s","AsyncFromSyncIteratorContinuation","r","Object","Promise","reject","done","resolve","value","then","n","next","prototype","apply","arguments","return","_return","ret","throw","_throw","thr","Hash","options","length","undefined","_classCallCheck2","default","_defineProperty2","hashBatches","bind","_createClass2","key","_preload","_asyncToGenerator2","_regenerator","mark","_callee","wrap","_callee$","_context","prev","abrupt","stop","preload","_this","_wrapAsyncGenerator2","_callee2","_this$options$crypto","_this$options$crypto$","arrayBuffers","_iteratorAbruptCompletion","_didIteratorError","_iteratorError","_iterator","_step","_arrayBuffer","output","hash","_callee2$","_context2","_awaitAsyncGenerator2","sent","arrayBuffer","push","t0","finish","concatenate","crypto","onEnd","_concatenate","_callee3","_callee3$","_context3","concatenateArrayBuffersAsync","_x","exports"],"sources":["../../../src/lib/hash.ts"],"sourcesContent":["// Hash\nimport {concatenateArrayBuffersAsync} from '@loaders.gl/loader-utils';\n\ntype HashOptions = {\n  modules?: {[moduleName: string]: any};\n  crypto?: {\n    onEnd?: (result: {hash: string}) => any;\n  };\n};\n\n/** Abstract hash base class */\nexport abstract class Hash {\n  abstract readonly name: string;\n  abstract readonly options: HashOptions;\n\n  constructor(options: HashOptions = {}) {\n    this.hashBatches = this.hashBatches.bind(this);\n  }\n\n  async preload(): Promise<void> {\n    return;\n  }\n\n  abstract hash(arrayBuffer: ArrayBuffer): Promise<string>;\n\n  async *hashBatches(\n    asyncIterator: AsyncIterable<ArrayBuffer> | Iterable<ArrayBuffer>\n  ): AsyncIterable<ArrayBuffer> {\n    const arrayBuffers: ArrayBuffer[] = [];\n    for await (const arrayBuffer of asyncIterator) {\n      arrayBuffers.push(arrayBuffer);\n      yield arrayBuffer;\n    }\n    const output = await this.concatenate(arrayBuffers);\n    const hash = await this.hash(output);\n    this.options.crypto?.onEnd?.({hash});\n  }\n\n  // HELPERS\n\n  protected async concatenate(asyncIterator): Promise<ArrayBuffer> {\n    return await concatenateArrayBuffersAsync(asyncIterator);\n  }\n}\n"],"mappings":"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"}