{"version":3,"file":"ome-utils.js","names":["_utils","require","DTYPE_LOOKUP","uint8","uint16","uint32","float","double","int8","int16","int32","exports","getOmePixelSourceMeta","_ref","Pixels","labels","getLabels","DimensionOrder","dims","getDims","shape","Array","length","fill","SizeT","SizeC","SizeZ","Interleaved","push","getShape","level","s","_toConsumableArray2","default","SizeX","SizeY","Type","Error","concat","dtype","PhysicalSizeX","PhysicalSizeY","physicalSizes","x","size","unit","PhysicalSizeXUnit","y","PhysicalSizeYUnit","PhysicalSizeZ","z","PhysicalSizeZUnit"],"sources":["../../../../src/lib/ome/ome-utils.ts"],"sourcesContent":["import {getDims, getLabels} from './utils';\nimport type {OMEXML, UnitsLength} from './omexml';\n\nexport const DTYPE_LOOKUP = {\n  uint8: 'Uint8',\n  uint16: 'Uint16',\n  uint32: 'Uint32',\n  float: 'Float32',\n  double: 'Float64',\n  int8: 'Int8',\n  int16: 'Int16',\n  int32: 'Int32'\n} as const;\n\nexport function getOmePixelSourceMeta({Pixels}: OMEXML[0]) {\n  // e.g. 'XYZCT' -> ['t', 'c', 'z', 'y', 'x']\n  const labels = getLabels(Pixels.DimensionOrder);\n\n  // Compute \"shape\" of image\n  const dims = getDims(labels);\n  const shape: number[] = Array(labels.length).fill(0);\n  shape[dims('t')] = Pixels.SizeT;\n  shape[dims('c')] = Pixels.SizeC;\n  shape[dims('z')] = Pixels.SizeZ;\n\n  // Push extra dimension if data are interleaved.\n  if (Pixels.Interleaved) {\n    // @ts-ignore\n    labels.push('_c');\n    shape.push(3);\n  }\n\n  // Creates a new shape for different level of pyramid.\n  // Assumes factor-of-two downsampling.\n  const getShape = (level: number) => {\n    const s = [...shape];\n    s[dims('x')] = Pixels.SizeX >> level;\n    s[dims('y')] = Pixels.SizeY >> level;\n    return s;\n  };\n\n  if (!(Pixels.Type in DTYPE_LOOKUP)) {\n    throw Error(`Pixel type ${Pixels.Type} not supported.`);\n  }\n\n  const dtype = DTYPE_LOOKUP[Pixels.Type as keyof typeof DTYPE_LOOKUP];\n  if (Pixels.PhysicalSizeX && Pixels.PhysicalSizeY) {\n    const physicalSizes: {\n      [k: string]: {size: number; unit: UnitsLength};\n    } = {\n      x: {\n        size: Pixels.PhysicalSizeX,\n        unit: Pixels.PhysicalSizeXUnit\n      },\n      y: {\n        size: Pixels.PhysicalSizeY,\n        unit: Pixels.PhysicalSizeYUnit\n      }\n    };\n    if (Pixels.PhysicalSizeZ) {\n      physicalSizes.z = {\n        size: Pixels.PhysicalSizeZ,\n        unit: Pixels.PhysicalSizeZUnit\n      };\n    }\n    return {labels, getShape, physicalSizes, dtype};\n  }\n\n  return {labels, getShape, dtype};\n}\n"],"mappings":";;;;;;;;;AAAA,IAAAA,MAAA,GAAAC,OAAA;AAGO,IAAMC,YAAY,GAAG;EAC1BC,KAAK,EAAE,OAAO;EACdC,MAAM,EAAE,QAAQ;EAChBC,MAAM,EAAE,QAAQ;EAChBC,KAAK,EAAE,SAAS;EAChBC,MAAM,EAAE,SAAS;EACjBC,IAAI,EAAE,MAAM;EACZC,KAAK,EAAE,OAAO;EACdC,KAAK,EAAE;AACT,CAAU;AAACC,OAAA,CAAAT,YAAA,GAAAA,YAAA;AAEJ,SAASU,qBAAqBA,CAAAC,IAAA,EAAsB;EAAA,IAApBC,MAAM,GAAAD,IAAA,CAANC,MAAM;EAE3C,IAAMC,MAAM,GAAG,IAAAC,gBAAS,EAACF,MAAM,CAACG,cAAc,CAAC;EAG/C,IAAMC,IAAI,GAAG,IAAAC,cAAO,EAACJ,MAAM,CAAC;EAC5B,IAAMK,KAAe,GAAGC,KAAK,CAACN,MAAM,CAACO,MAAM,CAAC,CAACC,IAAI,CAAC,CAAC,CAAC;EACpDH,KAAK,CAACF,IAAI,CAAC,GAAG,CAAC,CAAC,GAAGJ,MAAM,CAACU,KAAK;EAC/BJ,KAAK,CAACF,IAAI,CAAC,GAAG,CAAC,CAAC,GAAGJ,MAAM,CAACW,KAAK;EAC/BL,KAAK,CAACF,IAAI,CAAC,GAAG,CAAC,CAAC,GAAGJ,MAAM,CAACY,KAAK;EAG/B,IAAIZ,MAAM,CAACa,WAAW,EAAE;IAEtBZ,MAAM,CAACa,IAAI,CAAC,IAAI,CAAC;IACjBR,KAAK,CAACQ,IAAI,CAAC,CAAC,CAAC;EACf;EAIA,IAAMC,QAAQ,GAAG,SAAXA,QAAQA,CAAIC,KAAa,EAAK;IAClC,IAAMC,CAAC,OAAAC,mBAAA,CAAAC,OAAA,EAAOb,KAAK,CAAC;IACpBW,CAAC,CAACb,IAAI,CAAC,GAAG,CAAC,CAAC,GAAGJ,MAAM,CAACoB,KAAK,IAAIJ,KAAK;IACpCC,CAAC,CAACb,IAAI,CAAC,GAAG,CAAC,CAAC,GAAGJ,MAAM,CAACqB,KAAK,IAAIL,KAAK;IACpC,OAAOC,CAAC;EACV,CAAC;EAED,IAAI,EAAEjB,MAAM,CAACsB,IAAI,IAAIlC,YAAY,CAAC,EAAE;IAClC,MAAMmC,KAAK,eAAAC,MAAA,CAAexB,MAAM,CAACsB,IAAI,oBAAiB,CAAC;EACzD;EAEA,IAAMG,KAAK,GAAGrC,YAAY,CAACY,MAAM,CAACsB,IAAI,CAA8B;EACpE,IAAItB,MAAM,CAAC0B,aAAa,IAAI1B,MAAM,CAAC2B,aAAa,EAAE;IAChD,IAAMC,aAEL,GAAG;MACFC,CAAC,EAAE;QACDC,IAAI,EAAE9B,MAAM,CAAC0B,aAAa;QAC1BK,IAAI,EAAE/B,MAAM,CAACgC;MACf,CAAC;MACDC,CAAC,EAAE;QACDH,IAAI,EAAE9B,MAAM,CAAC2B,aAAa;QAC1BI,IAAI,EAAE/B,MAAM,CAACkC;MACf;IACF,CAAC;IACD,IAAIlC,MAAM,CAACmC,aAAa,EAAE;MACxBP,aAAa,CAACQ,CAAC,GAAG;QAChBN,IAAI,EAAE9B,MAAM,CAACmC,aAAa;QAC1BJ,IAAI,EAAE/B,MAAM,CAACqC;MACf,CAAC;IACH;IACA,OAAO;MAACpC,MAAM,EAANA,MAAM;MAAEc,QAAQ,EAARA,QAAQ;MAAEa,aAAa,EAAbA,aAAa;MAAEH,KAAK,EAALA;IAAK,CAAC;EACjD;EAEA,OAAO;IAACxB,MAAM,EAANA,MAAM;IAAEc,QAAQ,EAARA,QAAQ;IAAEU,KAAK,EAALA;EAAK,CAAC;AAClC"}