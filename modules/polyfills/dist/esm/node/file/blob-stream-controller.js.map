{"version":3,"file":"blob-stream-controller.js","names":["BlobStreamController","constructor","chunks","_defineProperty","start","controller","work","isWorking","isCancelled","desiredSize","next","error","done","enqueue","value","close","pull","cancel"],"sources":["../../../../src/node/file/blob-stream-controller.ts"],"sourcesContent":["/**\n * Forked from @gozala's web-blob under MIT license\n * @see https://github.com/Gozala/web-blob\n */\nexport class BlobStreamController {\n  private chunks: Iterator<Uint8Array>;\n  private isWorking: boolean = false;\n  private isCancelled: boolean = false;\n\n  /**\n   * @param chunks\n   */\n  constructor(chunks: Iterator<Uint8Array>) {\n    this.chunks = chunks;\n  }\n\n  /**\n   * @param controller\n   */\n  start(controller: ReadableStreamDefaultController) {\n    this.work(controller); // eslint-disable-line @typescript-eslint/no-floating-promises\n  }\n\n  /**\n   *\n   * @param controller\n   */\n  async work(controller: ReadableStreamDefaultController) {\n    const {chunks} = this;\n\n    this.isWorking = true;\n    while (!this.isCancelled && (controller.desiredSize || 0) > 0) {\n      let next: {done?: boolean; value?: Uint8Array} | undefined;\n      try {\n        next = chunks.next();\n      } catch (error) {\n        controller.error(error);\n        break;\n      }\n\n      if (next) {\n        if (!next.done && !this.isCancelled) {\n          controller.enqueue(next.value);\n        } else {\n          controller.close();\n        }\n      }\n    }\n\n    this.isWorking = false;\n  }\n\n  /**\n   *\n   * @param {ReadableStreamDefaultController} controller\n   */\n  pull(controller) {\n    if (!this.isWorking) {\n      this.work(controller); // eslint-disable-line @typescript-eslint/no-floating-promises\n    }\n  }\n  cancel() {\n    this.isCancelled = true;\n  }\n}\n"],"mappings":";AAIA,OAAO,MAAMA,oBAAoB,CAAC;EAQhCC,WAAWA,CAACC,MAA4B,EAAE;IAAAC,eAAA;IAAAA,eAAA,oBANb,KAAK;IAAAA,eAAA,sBACH,KAAK;IAMlC,IAAI,CAACD,MAAM,GAAGA,MAAM;EACtB;EAKAE,KAAKA,CAACC,UAA2C,EAAE;IACjD,IAAI,CAACC,IAAI,CAACD,UAAU,CAAC;EACvB;EAMA,MAAMC,IAAIA,CAACD,UAA2C,EAAE;IACtD,MAAM;MAACH;IAAM,CAAC,GAAG,IAAI;IAErB,IAAI,CAACK,SAAS,GAAG,IAAI;IACrB,OAAO,CAAC,IAAI,CAACC,WAAW,IAAI,CAACH,UAAU,CAACI,WAAW,IAAI,CAAC,IAAI,CAAC,EAAE;MAC7D,IAAIC,IAAsD;MAC1D,IAAI;QACFA,IAAI,GAAGR,MAAM,CAACQ,IAAI,CAAC,CAAC;MACtB,CAAC,CAAC,OAAOC,KAAK,EAAE;QACdN,UAAU,CAACM,KAAK,CAACA,KAAK,CAAC;QACvB;MACF;MAEA,IAAID,IAAI,EAAE;QACR,IAAI,CAACA,IAAI,CAACE,IAAI,IAAI,CAAC,IAAI,CAACJ,WAAW,EAAE;UACnCH,UAAU,CAACQ,OAAO,CAACH,IAAI,CAACI,KAAK,CAAC;QAChC,CAAC,MAAM;UACLT,UAAU,CAACU,KAAK,CAAC,CAAC;QACpB;MACF;IACF;IAEA,IAAI,CAACR,SAAS,GAAG,KAAK;EACxB;EAMAS,IAAIA,CAACX,UAAU,EAAE;IACf,IAAI,CAAC,IAAI,CAACE,SAAS,EAAE;MACnB,IAAI,CAACD,IAAI,CAACD,UAAU,CAAC;IACvB;EACF;EACAY,MAAMA,CAAA,EAAG;IACP,IAAI,CAACT,WAAW,GAAG,IAAI;EACzB;AACF"}