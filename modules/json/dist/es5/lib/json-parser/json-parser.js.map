{"version":3,"file":"json-parser.js","names":["_clarinet","_interopRequireDefault","require","_jsonpath","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty2","default","getOwnPropertyDescriptors","defineProperties","defineProperty","JSONParser","options","_this","_classCallCheck2","undefined","freeze","container","JSONPath","reset","parser","ClarinetParser","onready","jsonpath","previousStates","currentState","onopenobject","name","_openObject","emit","onkey","set","oncloseobject","_closeObject","onopenarray","_openArray","onclosearray","_closeArray","onvalue","value","_pushOrSet","onerror","error","onend","result","pop","_createClass2","write","chunk","close","_this$currentState","newContainer","isArray","exports"],"sources":["../../../../src/lib/json-parser/json-parser.ts"],"sourcesContent":["// @ts-nocheck\n\nimport ClarinetParser, {ClarinetParserOptions} from '../clarinet/clarinet';\nimport JSONPath from '../jsonpath/jsonpath';\n\n// JSONParser builds a JSON object using the events emitted by the Clarinet parser\n\nexport default class JSONParser {\n  readonly parser: ClarinetParser;\n  result = undefined;\n  previousStates = [];\n  currentState = Object.freeze({container: [], key: null});\n  jsonpath: JSONPath = new JSONPath();\n\n  constructor(options: ClarinetParserOptions) {\n    this.reset();\n    this.parser = new ClarinetParser({\n      onready: () => {\n        this.jsonpath = new JSONPath();\n        this.previousStates.length = 0;\n        this.currentState.container.length = 0;\n      },\n\n      onopenobject: (name) => {\n        this._openObject({});\n        if (typeof name !== 'undefined') {\n          this.parser.emit('onkey', name);\n        }\n      },\n\n      onkey: (name) => {\n        this.jsonpath.set(name);\n        this.currentState.key = name;\n      },\n\n      oncloseobject: () => {\n        this._closeObject();\n      },\n\n      onopenarray: () => {\n        this._openArray();\n      },\n\n      onclosearray: () => {\n        this._closeArray();\n      },\n\n      onvalue: (value) => {\n        this._pushOrSet(value);\n      },\n\n      onerror: (error) => {\n        throw error;\n      },\n\n      onend: () => {\n        this.result = this.currentState.container.pop();\n      },\n\n      ...options\n    });\n  }\n\n  reset(): void {\n    this.result = undefined;\n    this.previousStates = [];\n    this.currentState = Object.freeze({container: [], key: null});\n    this.jsonpath = new JSONPath();\n  }\n\n  write(chunk): void {\n    this.parser.write(chunk);\n  }\n\n  close(): void {\n    this.parser.close();\n  }\n\n  // PRIVATE METHODS\n\n  _pushOrSet(value): void {\n    const {container, key} = this.currentState;\n    if (key !== null) {\n      container[key] = value;\n      this.currentState.key = null;\n    } else {\n      container.push(value);\n    }\n  }\n\n  _openArray(newContainer = []): void {\n    this.jsonpath.push(null);\n    this._pushOrSet(newContainer);\n    this.previousStates.push(this.currentState);\n    this.currentState = {container: newContainer, isArray: true, key: null};\n  }\n\n  _closeArray(): void {\n    this.jsonpath.pop();\n    this.currentState = this.previousStates.pop();\n  }\n\n  _openObject(newContainer = {}): void {\n    this.jsonpath.push(null);\n    this._pushOrSet(newContainer);\n    this.previousStates.push(this.currentState);\n    this.currentState = {container: newContainer, isArray: false, key: null};\n  }\n\n  _closeObject(): void {\n    this.jsonpath.pop();\n    this.currentState = this.previousStates.pop();\n  }\n}\n"],"mappings":"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"}