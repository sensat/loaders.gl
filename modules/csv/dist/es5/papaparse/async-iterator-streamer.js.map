{"version":3,"file":"async-iterator-streamer.js","names":["_papaparse","_interopRequireDefault","require","_asyncIterator","iterable","method","async","sync","retry","Symbol","asyncIterator","iterator","call","AsyncFromSyncIterator","TypeError","s","AsyncFromSyncIteratorContinuation","r","Object","Promise","reject","done","resolve","value","then","n","next","prototype","apply","arguments","return","_return","ret","throw","_throw","thr","ChunkStreamer","Papa","AsyncIteratorStreamer","config","textDecoder","TextDecoder","_config","encoding","stream","_ref","_asyncToGenerator2","default","_regenerator","mark","_callee","_iteratorAbruptCompletion","_didIteratorError","_iteratorError","_iterator","_step","chunk","wrap","_callee$","_context","prev","_input","sent","parseChunk","getStringChunk","t0","finish","_finished","t1","_sendError","stop","_x","_nextChunk","nextChunk","decode","create","constructor"],"sources":["../../../src/papaparse/async-iterator-streamer.ts"],"sourcesContent":["// @ts-nocheck\n// A custom papaparse `Streamer` for async iterators\n// Ideally this can be contributed back to papaparse\n// Or papaparse can expose Streamer API so we can extend without forking.\n\n/* eslint-disable no-invalid-this */\n\n// Note: papaparse is not an ES6 module\nimport Papa from './papaparse';\nconst {ChunkStreamer} = Papa;\n\nexport default function AsyncIteratorStreamer(config) {\n  config = config || {};\n\n  ChunkStreamer.call(this, config);\n\n  this.textDecoder = new TextDecoder(this._config.encoding);\n\n  // Implement ChunkStreamer base class methods\n\n  // this.pause = function() {\n  //   ChunkStreamer.prototype.pause.apply(this, arguments);\n  // };\n\n  // this.resume = function() {\n  //   ChunkStreamer.prototype.resume.apply(this, arguments);\n  //   this._input.resume();\n  // };\n\n  this.stream = async function (asyncIterator) {\n    this._input = asyncIterator;\n\n    try {\n      // ES2018 version\n      // TODO - check for pause and abort flags?\n      for await (const chunk of asyncIterator) {\n        this.parseChunk(this.getStringChunk(chunk));\n      }\n\n      // ES5 VERSION\n      // while (true) {\n      //   asyncIterator.next().then(function(value) {\n      //     if (value.done) {\n      //       // finalize iterator?\n      //     }\n      //   }\n      //   const  = await ;\n      //   if (done) return total;\n      //   total += value.length;\n      // }\n\n      this._finished = true;\n      this.parseChunk('');\n    } catch (error) {\n      // Inform ChunkStreamer base class of error\n      this._sendError(error);\n    }\n  };\n\n  this._nextChunk = function nextChunk() {\n    // Left empty, as async iterator automatically pulls next chunk\n  };\n\n  // HELPER METHODS\n  this.getStringChunk = function (chunk) {\n    return typeof chunk === 'string' ? chunk : this.textDecoder.decode(chunk, {stream: true});\n  };\n}\n\nAsyncIteratorStreamer.prototype = Object.create(ChunkStreamer.prototype);\nAsyncIteratorStreamer.prototype.constructor = AsyncIteratorStreamer;\n"],"mappings":"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"}