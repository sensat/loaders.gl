{"version":3,"file":"binary-writer.js","names":["LE","BE","BinaryWriter","constructor","size","allowResize","_defineProperty","arrayBuffer","ArrayBuffer","dataView","DataView","byteOffset","writeUInt8","value","_ensureSize","setUint8","writeUInt16LE","setUint16","writeUInt16BE","writeUInt32LE","setUint32","writeUInt32BE","writeInt8","setInt8","writeInt16LE","setInt16","writeInt16BE","writeInt32LE","setInt32","writeInt32BE","writeFloatLE","setFloat32","writeFloatBE","writeDoubleLE","setFloat64","writeDoubleBE","writeVarInt","length","writeBuffer","byteLength","tempArray","Uint8Array","set","newArrayBuffer","Error"],"sources":["../../../../src/lib/utils/binary-writer.ts"],"sourcesContent":["// loaders.gl, MIT license\n// Forked from https://github.com/cschwarz/wkx under MIT license, Copyright (c) 2013 Christian Schwarz\n\nconst LE = true;\nconst BE = false;\n\nexport default class BinaryWriter {\n  arrayBuffer: ArrayBuffer;\n  dataView: DataView;\n  byteOffset: number = 0;\n  allowResize: boolean = false;\n\n  constructor(size: number, allowResize?: boolean) {\n    this.arrayBuffer = new ArrayBuffer(size);\n    this.dataView = new DataView(this.arrayBuffer);\n    this.byteOffset = 0;\n    this.allowResize = allowResize || false;\n  }\n\n  writeUInt8(value: number): void {\n    this._ensureSize(1);\n    this.dataView.setUint8(this.byteOffset, value);\n    this.byteOffset += 1;\n  }\n  writeUInt16LE(value: number): void {\n    this._ensureSize(2);\n    this.dataView.setUint16(this.byteOffset, value, LE);\n    this.byteOffset += 2;\n  }\n  writeUInt16BE(value: number): void {\n    this._ensureSize(2);\n    this.dataView.setUint16(this.byteOffset, value, BE);\n    this.byteOffset += 2;\n  }\n  writeUInt32LE(value: number): void {\n    this._ensureSize(4);\n    this.dataView.setUint32(this.byteOffset, value, LE);\n    this.byteOffset += 4;\n  }\n  writeUInt32BE(value: number): void {\n    this._ensureSize(4);\n    this.dataView.setUint32(this.byteOffset, value, BE);\n    this.byteOffset += 4;\n  }\n  writeInt8(value: number): void {\n    this._ensureSize(1);\n    this.dataView.setInt8(this.byteOffset, value);\n    this.byteOffset += 1;\n  }\n  writeInt16LE(value: number): void {\n    this._ensureSize(2);\n    this.dataView.setInt16(this.byteOffset, value, LE);\n    this.byteOffset += 2;\n  }\n  writeInt16BE(value: number): void {\n    this._ensureSize(2);\n    this.dataView.setInt16(this.byteOffset, value, BE);\n    this.byteOffset += 2;\n  }\n  writeInt32LE(value: number): void {\n    this._ensureSize(4);\n    this.dataView.setInt32(this.byteOffset, value, LE);\n    this.byteOffset += 4;\n  }\n  writeInt32BE(value: number): void {\n    this._ensureSize(4);\n    this.dataView.setInt32(this.byteOffset, value, BE);\n    this.byteOffset += 4;\n  }\n  writeFloatLE(value: number): void {\n    this._ensureSize(4);\n    this.dataView.setFloat32(this.byteOffset, value, LE);\n    this.byteOffset += 4;\n  }\n  writeFloatBE(value: number): void {\n    this._ensureSize(4);\n    this.dataView.setFloat32(this.byteOffset, value, BE);\n    this.byteOffset += 4;\n  }\n  writeDoubleLE(value: number): void {\n    this._ensureSize(8);\n    this.dataView.setFloat64(this.byteOffset, value, LE);\n    this.byteOffset += 8;\n  }\n  writeDoubleBE(value: number): void {\n    this._ensureSize(8);\n    this.dataView.setFloat64(this.byteOffset, value, BE);\n    this.byteOffset += 8;\n  }\n\n  /** A varint uses a variable number of bytes */\n  writeVarInt(value: number): number {\n    // TODO - ensure size?\n    let length = 1;\n    while ((value & 0xffffff80) !== 0) {\n      this.writeUInt8((value & 0x7f) | 0x80);\n      value >>>= 7;\n      length++;\n    }\n    this.writeUInt8(value & 0x7f);\n    return length;\n  }\n\n  /** Append another ArrayBuffer to this ArrayBuffer */\n  writeBuffer(arrayBuffer: ArrayBuffer): void {\n    this._ensureSize(arrayBuffer.byteLength);\n    const tempArray = new Uint8Array(this.arrayBuffer);\n    tempArray.set(new Uint8Array(arrayBuffer), this.byteOffset);\n    this.byteOffset += arrayBuffer.byteLength;\n  }\n\n  /** Resizes this.arrayBuffer if not enough space */\n  _ensureSize(size: number) {\n    if (this.arrayBuffer.byteLength < this.byteOffset + size) {\n      if (this.allowResize) {\n        const newArrayBuffer = new ArrayBuffer(this.byteOffset + size);\n        const tempArray = new Uint8Array(newArrayBuffer);\n        tempArray.set(new Uint8Array(this.arrayBuffer));\n        this.arrayBuffer = newArrayBuffer;\n      } else {\n        throw new Error('BinaryWriter overflow');\n      }\n    }\n  }\n}\n"],"mappings":";AAGA,MAAMA,EAAE,GAAG,IAAI;AACf,MAAMC,EAAE,GAAG,KAAK;AAEhB,eAAe,MAAMC,YAAY,CAAC;EAMhCC,WAAWA,CAACC,IAAY,EAAEC,WAAqB,EAAE;IAAAC,eAAA;IAAAA,eAAA;IAAAA,eAAA,qBAH5B,CAAC;IAAAA,eAAA,sBACC,KAAK;IAG1B,IAAI,CAACC,WAAW,GAAG,IAAIC,WAAW,CAACJ,IAAI,CAAC;IACxC,IAAI,CAACK,QAAQ,GAAG,IAAIC,QAAQ,CAAC,IAAI,CAACH,WAAW,CAAC;IAC9C,IAAI,CAACI,UAAU,GAAG,CAAC;IACnB,IAAI,CAACN,WAAW,GAAGA,WAAW,IAAI,KAAK;EACzC;EAEAO,UAAUA,CAACC,KAAa,EAAQ;IAC9B,IAAI,CAACC,WAAW,CAAC,CAAC,CAAC;IACnB,IAAI,CAACL,QAAQ,CAACM,QAAQ,CAAC,IAAI,CAACJ,UAAU,EAAEE,KAAK,CAAC;IAC9C,IAAI,CAACF,UAAU,IAAI,CAAC;EACtB;EACAK,aAAaA,CAACH,KAAa,EAAQ;IACjC,IAAI,CAACC,WAAW,CAAC,CAAC,CAAC;IACnB,IAAI,CAACL,QAAQ,CAACQ,SAAS,CAAC,IAAI,CAACN,UAAU,EAAEE,KAAK,EAAEb,EAAE,CAAC;IACnD,IAAI,CAACW,UAAU,IAAI,CAAC;EACtB;EACAO,aAAaA,CAACL,KAAa,EAAQ;IACjC,IAAI,CAACC,WAAW,CAAC,CAAC,CAAC;IACnB,IAAI,CAACL,QAAQ,CAACQ,SAAS,CAAC,IAAI,CAACN,UAAU,EAAEE,KAAK,EAAEZ,EAAE,CAAC;IACnD,IAAI,CAACU,UAAU,IAAI,CAAC;EACtB;EACAQ,aAAaA,CAACN,KAAa,EAAQ;IACjC,IAAI,CAACC,WAAW,CAAC,CAAC,CAAC;IACnB,IAAI,CAACL,QAAQ,CAACW,SAAS,CAAC,IAAI,CAACT,UAAU,EAAEE,KAAK,EAAEb,EAAE,CAAC;IACnD,IAAI,CAACW,UAAU,IAAI,CAAC;EACtB;EACAU,aAAaA,CAACR,KAAa,EAAQ;IACjC,IAAI,CAACC,WAAW,CAAC,CAAC,CAAC;IACnB,IAAI,CAACL,QAAQ,CAACW,SAAS,CAAC,IAAI,CAACT,UAAU,EAAEE,KAAK,EAAEZ,EAAE,CAAC;IACnD,IAAI,CAACU,UAAU,IAAI,CAAC;EACtB;EACAW,SAASA,CAACT,KAAa,EAAQ;IAC7B,IAAI,CAACC,WAAW,CAAC,CAAC,CAAC;IACnB,IAAI,CAACL,QAAQ,CAACc,OAAO,CAAC,IAAI,CAACZ,UAAU,EAAEE,KAAK,CAAC;IAC7C,IAAI,CAACF,UAAU,IAAI,CAAC;EACtB;EACAa,YAAYA,CAACX,KAAa,EAAQ;IAChC,IAAI,CAACC,WAAW,CAAC,CAAC,CAAC;IACnB,IAAI,CAACL,QAAQ,CAACgB,QAAQ,CAAC,IAAI,CAACd,UAAU,EAAEE,KAAK,EAAEb,EAAE,CAAC;IAClD,IAAI,CAACW,UAAU,IAAI,CAAC;EACtB;EACAe,YAAYA,CAACb,KAAa,EAAQ;IAChC,IAAI,CAACC,WAAW,CAAC,CAAC,CAAC;IACnB,IAAI,CAACL,QAAQ,CAACgB,QAAQ,CAAC,IAAI,CAACd,UAAU,EAAEE,KAAK,EAAEZ,EAAE,CAAC;IAClD,IAAI,CAACU,UAAU,IAAI,CAAC;EACtB;EACAgB,YAAYA,CAACd,KAAa,EAAQ;IAChC,IAAI,CAACC,WAAW,CAAC,CAAC,CAAC;IACnB,IAAI,CAACL,QAAQ,CAACmB,QAAQ,CAAC,IAAI,CAACjB,UAAU,EAAEE,KAAK,EAAEb,EAAE,CAAC;IAClD,IAAI,CAACW,UAAU,IAAI,CAAC;EACtB;EACAkB,YAAYA,CAAChB,KAAa,EAAQ;IAChC,IAAI,CAACC,WAAW,CAAC,CAAC,CAAC;IACnB,IAAI,CAACL,QAAQ,CAACmB,QAAQ,CAAC,IAAI,CAACjB,UAAU,EAAEE,KAAK,EAAEZ,EAAE,CAAC;IAClD,IAAI,CAACU,UAAU,IAAI,CAAC;EACtB;EACAmB,YAAYA,CAACjB,KAAa,EAAQ;IAChC,IAAI,CAACC,WAAW,CAAC,CAAC,CAAC;IACnB,IAAI,CAACL,QAAQ,CAACsB,UAAU,CAAC,IAAI,CAACpB,UAAU,EAAEE,KAAK,EAAEb,EAAE,CAAC;IACpD,IAAI,CAACW,UAAU,IAAI,CAAC;EACtB;EACAqB,YAAYA,CAACnB,KAAa,EAAQ;IAChC,IAAI,CAACC,WAAW,CAAC,CAAC,CAAC;IACnB,IAAI,CAACL,QAAQ,CAACsB,UAAU,CAAC,IAAI,CAACpB,UAAU,EAAEE,KAAK,EAAEZ,EAAE,CAAC;IACpD,IAAI,CAACU,UAAU,IAAI,CAAC;EACtB;EACAsB,aAAaA,CAACpB,KAAa,EAAQ;IACjC,IAAI,CAACC,WAAW,CAAC,CAAC,CAAC;IACnB,IAAI,CAACL,QAAQ,CAACyB,UAAU,CAAC,IAAI,CAACvB,UAAU,EAAEE,KAAK,EAAEb,EAAE,CAAC;IACpD,IAAI,CAACW,UAAU,IAAI,CAAC;EACtB;EACAwB,aAAaA,CAACtB,KAAa,EAAQ;IACjC,IAAI,CAACC,WAAW,CAAC,CAAC,CAAC;IACnB,IAAI,CAACL,QAAQ,CAACyB,UAAU,CAAC,IAAI,CAACvB,UAAU,EAAEE,KAAK,EAAEZ,EAAE,CAAC;IACpD,IAAI,CAACU,UAAU,IAAI,CAAC;EACtB;EAGAyB,WAAWA,CAACvB,KAAa,EAAU;IAEjC,IAAIwB,MAAM,GAAG,CAAC;IACd,OAAO,CAACxB,KAAK,GAAG,UAAU,MAAM,CAAC,EAAE;MACjC,IAAI,CAACD,UAAU,CAAEC,KAAK,GAAG,IAAI,GAAI,IAAI,CAAC;MACtCA,KAAK,MAAM,CAAC;MACZwB,MAAM,EAAE;IACV;IACA,IAAI,CAACzB,UAAU,CAACC,KAAK,GAAG,IAAI,CAAC;IAC7B,OAAOwB,MAAM;EACf;EAGAC,WAAWA,CAAC/B,WAAwB,EAAQ;IAC1C,IAAI,CAACO,WAAW,CAACP,WAAW,CAACgC,UAAU,CAAC;IACxC,MAAMC,SAAS,GAAG,IAAIC,UAAU,CAAC,IAAI,CAAClC,WAAW,CAAC;IAClDiC,SAAS,CAACE,GAAG,CAAC,IAAID,UAAU,CAAClC,WAAW,CAAC,EAAE,IAAI,CAACI,UAAU,CAAC;IAC3D,IAAI,CAACA,UAAU,IAAIJ,WAAW,CAACgC,UAAU;EAC3C;EAGAzB,WAAWA,CAACV,IAAY,EAAE;IACxB,IAAI,IAAI,CAACG,WAAW,CAACgC,UAAU,GAAG,IAAI,CAAC5B,UAAU,GAAGP,IAAI,EAAE;MACxD,IAAI,IAAI,CAACC,WAAW,EAAE;QACpB,MAAMsC,cAAc,GAAG,IAAInC,WAAW,CAAC,IAAI,CAACG,UAAU,GAAGP,IAAI,CAAC;QAC9D,MAAMoC,SAAS,GAAG,IAAIC,UAAU,CAACE,cAAc,CAAC;QAChDH,SAAS,CAACE,GAAG,CAAC,IAAID,UAAU,CAAC,IAAI,CAAClC,WAAW,CAAC,CAAC;QAC/C,IAAI,CAACA,WAAW,GAAGoC,cAAc;MACnC,CAAC,MAAM;QACL,MAAM,IAAIC,KAAK,CAAC,uBAAuB,CAAC;MAC1C;IACF;EACF;AACF"}