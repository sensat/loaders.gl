{"version":3,"file":"parse-xml.js","names":["StreamingXMLParser","uncapitalizeKeys","XMLParser","FastXMLParser","parseXMLSync","text","options","_parser","Error","fastXMLOptions","allowBooleanAttributes","ignoreDeclaration","removeNSPrefix","textNodeName","isArray","name","jpath","isLeafNode","isAttribute","_options$arrayPaths","array","Boolean","arrayPaths","some","path","_fastXML","xml","fastParseXML","parser","ignoreAttributes","attributeNamePrefix","parsedXML","parse","parseXMLInBatches","arguments","length","undefined","strict","write","close","result"],"sources":["../../../../src/lib/parsers/parse-xml.ts"],"sourcesContent":["// loaders.gl, MIT license\n\nimport type {SAXParserOptions} from '../../sax-ts/sax';\nimport {StreamingXMLParser} from './streaming-xml-parser';\nimport {uncapitalizeKeys} from '../xml-utils/uncapitalize';\nimport {XMLParser as FastXMLParser} from 'fast-xml-parser';\nimport type {X2jOptions} from 'fast-xml-parser';\n\nexport type ParseXMLOptions = {\n  /** XML is typically PascalCase, JavaScript prefects camelCase */\n  uncapitalizeKeys?: boolean;\n  removeNSPrefix?: boolean;\n  textNodeName?: string;\n  arrayPaths?: string[];\n\n  // NOTE: Only fast-xml-parser is implemented\n  _parser?: 'fast-xml-parser' | 'sax';\n  /** @deprecated Experimental, passes options to fast-xml-parser, IF it is being used */\n  _fastXML?: _FastParseXMLOptions;\n  /** @deprecated Experimental, passes options to the SAX XML parser, IF it is being used. */\n  _sax?: SAXParserOptions;\n};\n\n/** Type for passing through fast-xml-parser options */\nexport type _FastParseXMLOptions = Partial<X2jOptions>;\n\nexport function parseXMLSync(text: string, options?: ParseXMLOptions): any {\n  if (options?._parser && options._parser !== 'fast-xml-parser') {\n    throw new Error(options?._parser);\n  }\n\n  const fastXMLOptions: _FastParseXMLOptions = {\n    // Default FastXML options\n    // https://github.com/NaturalIntelligence/fast-xml-parser/blob/master/docs/v4/2.XMLparseOptions.md#allowbooleanattributes\n    allowBooleanAttributes: true,\n    // https://github.com/NaturalIntelligence/fast-xml-parser/blob/master/docs/v4/2.XMLparseOptions.md#ignoredeclaration\n    ignoreDeclaration: true,\n\n    // https://github.com/NaturalIntelligence/fast-xml-parser/blob/master/docs/v4/2.XMLparseOptions.md#removensprefix\n    removeNSPrefix: options?.removeNSPrefix,\n\n    // https://github.com/NaturalIntelligence/fast-xml-parser/blob/master/docs/v4/2.XMLparseOptions.md#textnodename\n    textNodeName: options?.textNodeName,\n\n    // Let's application specify keys that are always arrays\n    isArray: (name: string, jpath: string, isLeafNode: boolean, isAttribute: boolean) => {\n      const array = Boolean(options?.arrayPaths?.some((path) => jpath === path));\n      return array;\n    },\n\n    // Application overrides\n    ...options?._fastXML\n  };\n\n  const xml = fastParseXML(text, fastXMLOptions);\n\n  // Note - could be done with FastXML tag processing\n  return options?.uncapitalizeKeys ? uncapitalizeKeys(xml) : xml;\n}\n\nexport function fastParseXML(text: string, options: _FastParseXMLOptions): any {\n  const parser = new FastXMLParser({\n    ignoreAttributes: false,\n    attributeNamePrefix: '',\n    ...options\n  });\n\n  const parsedXML = parser.parse(text);\n\n  return parsedXML;\n}\n\n/**\n * @todo Build a streaming XML parser based on sax-js\n * @param text\n * @param options\n * @returns\n */\nexport function parseXMLInBatches(text: string, options = {}): any {\n  const parser = new StreamingXMLParser({\n    ...options,\n    strict: true\n  });\n\n  parser.write(text);\n  parser.close();\n\n  return parser.result;\n}\n"],"mappings":"AAGA,SAAQA,kBAAkB,QAAO,wBAAwB;AACzD,SAAQC,gBAAgB,QAAO,2BAA2B;AAC1D,SAAQC,SAAS,IAAIC,aAAa,QAAO,iBAAiB;AAqB1D,OAAO,SAASC,YAAYA,CAACC,IAAY,EAAEC,OAAyB,EAAO;EACzE,IAAIA,OAAO,aAAPA,OAAO,eAAPA,OAAO,CAAEC,OAAO,IAAID,OAAO,CAACC,OAAO,KAAK,iBAAiB,EAAE;IAC7D,MAAM,IAAIC,KAAK,CAACF,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEC,OAAO,CAAC;EACnC;EAEA,MAAME,cAAoC,GAAG;IAG3CC,sBAAsB,EAAE,IAAI;IAE5BC,iBAAiB,EAAE,IAAI;IAGvBC,cAAc,EAAEN,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEM,cAAc;IAGvCC,YAAY,EAAEP,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEO,YAAY;IAGnCC,OAAO,EAAEA,CAACC,IAAY,EAAEC,KAAa,EAAEC,UAAmB,EAAEC,WAAoB,KAAK;MAAA,IAAAC,mBAAA;MACnF,MAAMC,KAAK,GAAGC,OAAO,CAACf,OAAO,aAAPA,OAAO,wBAAAa,mBAAA,GAAPb,OAAO,CAAEgB,UAAU,cAAAH,mBAAA,uBAAnBA,mBAAA,CAAqBI,IAAI,CAAEC,IAAI,IAAKR,KAAK,KAAKQ,IAAI,CAAC,CAAC;MAC1E,OAAOJ,KAAK;IACd,CAAC;IAGD,IAAGd,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEmB,QAAQ;EACtB,CAAC;EAED,MAAMC,GAAG,GAAGC,YAAY,CAACtB,IAAI,EAAEI,cAAc,CAAC;EAG9C,OAAOH,OAAO,aAAPA,OAAO,eAAPA,OAAO,CAAEL,gBAAgB,GAAGA,gBAAgB,CAACyB,GAAG,CAAC,GAAGA,GAAG;AAChE;AAEA,OAAO,SAASC,YAAYA,CAACtB,IAAY,EAAEC,OAA6B,EAAO;EAC7E,MAAMsB,MAAM,GAAG,IAAIzB,aAAa,CAAC;IAC/B0B,gBAAgB,EAAE,KAAK;IACvBC,mBAAmB,EAAE,EAAE;IACvB,GAAGxB;EACL,CAAC,CAAC;EAEF,MAAMyB,SAAS,GAAGH,MAAM,CAACI,KAAK,CAAC3B,IAAI,CAAC;EAEpC,OAAO0B,SAAS;AAClB;AAQA,OAAO,SAASE,iBAAiBA,CAAC5B,IAAY,EAAqB;EAAA,IAAnBC,OAAO,GAAA4B,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,CAAC,CAAC;EAC1D,MAAMN,MAAM,GAAG,IAAI5B,kBAAkB,CAAC;IACpC,GAAGM,OAAO;IACV+B,MAAM,EAAE;EACV,CAAC,CAAC;EAEFT,MAAM,CAACU,KAAK,CAACjC,IAAI,CAAC;EAClBuB,MAAM,CAACW,KAAK,CAAC,CAAC;EAEd,OAAOX,MAAM,CAACY,MAAM;AACtB"}