{"version":3,"file":"parse-xml.js","names":["_streamingXmlParser","require","_uncapitalize","_fastXmlParser","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty2","default","getOwnPropertyDescriptors","defineProperties","defineProperty","parseXMLSync","text","options","_parser","Error","fastXMLOptions","allowBooleanAttributes","ignoreDeclaration","removeNSPrefix","textNodeName","isArray","name","jpath","isLeafNode","isAttribute","_options$arrayPaths","array","Boolean","arrayPaths","some","path","_fastXML","xml","fastParseXML","uncapitalizeKeys","parser","FastXMLParser","ignoreAttributes","attributeNamePrefix","parsedXML","parse","parseXMLInBatches","undefined","StreamingXMLParser","strict","write","close","result"],"sources":["../../../../src/lib/parsers/parse-xml.ts"],"sourcesContent":["// loaders.gl, MIT license\n\nimport type {SAXParserOptions} from '../../sax-ts/sax';\nimport {StreamingXMLParser} from './streaming-xml-parser';\nimport {uncapitalizeKeys} from '../xml-utils/uncapitalize';\nimport {XMLParser as FastXMLParser} from 'fast-xml-parser';\nimport type {X2jOptions} from 'fast-xml-parser';\n\nexport type ParseXMLOptions = {\n  /** XML is typically PascalCase, JavaScript prefects camelCase */\n  uncapitalizeKeys?: boolean;\n  removeNSPrefix?: boolean;\n  textNodeName?: string;\n  arrayPaths?: string[];\n\n  // NOTE: Only fast-xml-parser is implemented\n  _parser?: 'fast-xml-parser' | 'sax';\n  /** @deprecated Experimental, passes options to fast-xml-parser, IF it is being used */\n  _fastXML?: _FastParseXMLOptions;\n  /** @deprecated Experimental, passes options to the SAX XML parser, IF it is being used. */\n  _sax?: SAXParserOptions;\n};\n\n/** Type for passing through fast-xml-parser options */\nexport type _FastParseXMLOptions = Partial<X2jOptions>;\n\nexport function parseXMLSync(text: string, options?: ParseXMLOptions): any {\n  if (options?._parser && options._parser !== 'fast-xml-parser') {\n    throw new Error(options?._parser);\n  }\n\n  const fastXMLOptions: _FastParseXMLOptions = {\n    // Default FastXML options\n    // https://github.com/NaturalIntelligence/fast-xml-parser/blob/master/docs/v4/2.XMLparseOptions.md#allowbooleanattributes\n    allowBooleanAttributes: true,\n    // https://github.com/NaturalIntelligence/fast-xml-parser/blob/master/docs/v4/2.XMLparseOptions.md#ignoredeclaration\n    ignoreDeclaration: true,\n\n    // https://github.com/NaturalIntelligence/fast-xml-parser/blob/master/docs/v4/2.XMLparseOptions.md#removensprefix\n    removeNSPrefix: options?.removeNSPrefix,\n\n    // https://github.com/NaturalIntelligence/fast-xml-parser/blob/master/docs/v4/2.XMLparseOptions.md#textnodename\n    textNodeName: options?.textNodeName,\n\n    // Let's application specify keys that are always arrays\n    isArray: (name: string, jpath: string, isLeafNode: boolean, isAttribute: boolean) => {\n      const array = Boolean(options?.arrayPaths?.some((path) => jpath === path));\n      return array;\n    },\n\n    // Application overrides\n    ...options?._fastXML\n  };\n\n  const xml = fastParseXML(text, fastXMLOptions);\n\n  // Note - could be done with FastXML tag processing\n  return options?.uncapitalizeKeys ? uncapitalizeKeys(xml) : xml;\n}\n\nexport function fastParseXML(text: string, options: _FastParseXMLOptions): any {\n  const parser = new FastXMLParser({\n    ignoreAttributes: false,\n    attributeNamePrefix: '',\n    ...options\n  });\n\n  const parsedXML = parser.parse(text);\n\n  return parsedXML;\n}\n\n/**\n * @todo Build a streaming XML parser based on sax-js\n * @param text\n * @param options\n * @returns\n */\nexport function parseXMLInBatches(text: string, options = {}): any {\n  const parser = new StreamingXMLParser({\n    ...options,\n    strict: true\n  });\n\n  parser.write(text);\n  parser.close();\n\n  return parser.result;\n}\n"],"mappings":"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"}