{"version":3,"file":"zip-writer.js","names":["_jszip","_interopRequireDefault","require","ZipWriter","name","extensions","category","mimeTypes","encode","encodeZipAsync","exports","_x","_encodeZipAsync","apply","arguments","_asyncToGenerator2","default","_regenerator","mark","_callee","fileMap","options","jsZip","subFileName","subFileData","_options","_options$onUpdate","onUpdate","_args","wrap","_callee$","_context","prev","next","length","undefined","JSZip","file","Object","assign","type","abrupt","generateAsync","catch","error","log","concat","stop"],"sources":["../../src/zip-writer.ts"],"sourcesContent":["import type {Writer} from '@loaders.gl/loader-utils';\nimport JSZip from 'jszip';\n\n/**\n * Zip exporter\n */\nexport const ZipWriter: Writer = {\n  name: 'Zip Archive',\n  extensions: ['zip'],\n  category: 'archive',\n  mimeTypes: ['application/zip'],\n  // @ts-ignore\n  encode: encodeZipAsync\n};\n\nasync function encodeZipAsync(fileMap: any, options: any = {}) {\n  const jsZip = new JSZip();\n  // add files to the zip\n  for (const subFileName in fileMap) {\n    const subFileData = fileMap[subFileName];\n\n    // jszip supports both arraybuffer and string data (the main loaders.gl types)\n    // https://stuk.github.io/jszip/documentation/api_zipobject/async.html\n    jsZip.file(subFileName, subFileData, options);\n  }\n\n  // always generate the full zip as an arraybuffer\n  options = Object.assign({}, options, {\n    type: 'arraybuffer'\n  });\n  const {onUpdate = () => {}} = options;\n\n  return jsZip.generateAsync(options, onUpdate).catch((error) => {\n    options.log.error(`Unable to write zip archive: ${error}`);\n    throw error;\n  });\n}\n"],"mappings":";;;;;;;;;AACA,IAAAA,MAAA,GAAAC,sBAAA,CAAAC,OAAA;AAKO,IAAMC,SAAiB,GAAG;EAC/BC,IAAI,EAAE,aAAa;EACnBC,UAAU,EAAE,CAAC,KAAK,CAAC;EACnBC,QAAQ,EAAE,SAAS;EACnBC,SAAS,EAAE,CAAC,iBAAiB,CAAC;EAE9BC,MAAM,EAAEC;AACV,CAAC;AAACC,OAAA,CAAAP,SAAA,GAAAA,SAAA;AAAA,SAEaM,cAAcA,CAAAE,EAAA;EAAA,OAAAC,eAAA,CAAAC,KAAA,OAAAC,SAAA;AAAA;AAAA,SAAAF,gBAAA;EAAAA,eAAA,OAAAG,kBAAA,CAAAC,OAAA,EAAAC,YAAA,CAAAD,OAAA,CAAAE,IAAA,CAA7B,SAAAC,QAA8BC,OAAY;IAAA,IAAAC,OAAA;MAAAC,KAAA;MAAAC,WAAA;MAAAC,WAAA;MAAAC,QAAA;MAAAC,iBAAA;MAAAC,QAAA;MAAAC,KAAA,GAAAd,SAAA;IAAA,OAAAG,YAAA,CAAAD,OAAA,CAAAa,IAAA,UAAAC,SAAAC,QAAA;MAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;QAAA;UAAEZ,OAAY,GAAAO,KAAA,CAAAM,MAAA,QAAAN,KAAA,QAAAO,SAAA,GAAAP,KAAA,MAAG,CAAC,CAAC;UACrDN,KAAK,GAAG,IAAIc,cAAK,CAAC,CAAC;UAEzB,KAAWb,WAAW,IAAIH,OAAO,EAAE;YAC3BI,WAAW,GAAGJ,OAAO,CAACG,WAAW,CAAC;YAIxCD,KAAK,CAACe,IAAI,CAACd,WAAW,EAAEC,WAAW,EAAEH,OAAO,CAAC;UAC/C;UAGAA,OAAO,GAAGiB,MAAM,CAACC,MAAM,CAAC,CAAC,CAAC,EAAElB,OAAO,EAAE;YACnCmB,IAAI,EAAE;UACR,CAAC,CAAC;UAACf,QAAA,GAC2BJ,OAAO,EAAAK,iBAAA,GAAAD,QAAA,CAA9BE,QAAQ,EAARA,QAAQ,GAAAD,iBAAA,cAAG,YAAM,CAAC,CAAC,GAAAA,iBAAA;UAAA,OAAAK,QAAA,CAAAU,MAAA,WAEnBnB,KAAK,CAACoB,aAAa,CAACrB,OAAO,EAAEM,QAAQ,CAAC,CAACgB,KAAK,CAAC,UAACC,KAAK,EAAK;YAC7DvB,OAAO,CAACwB,GAAG,CAACD,KAAK,iCAAAE,MAAA,CAAiCF,KAAK,CAAE,CAAC;YAC1D,MAAMA,KAAK;UACb,CAAC,CAAC;QAAA;QAAA;UAAA,OAAAb,QAAA,CAAAgB,IAAA;MAAA;IAAA,GAAA5B,OAAA;EAAA,CACH;EAAA,OAAAP,eAAA,CAAAC,KAAA,OAAAC,SAAA;AAAA"}