{"version":3,"file":"zip-writer.js","names":["JSZip","ZipWriter","name","extensions","category","mimeTypes","encode","encodeZipAsync","fileMap","options","arguments","length","undefined","jsZip","subFileName","subFileData","file","Object","assign","type","onUpdate","generateAsync","catch","error","log","concat"],"sources":["../../src/zip-writer.ts"],"sourcesContent":["import type {Writer} from '@loaders.gl/loader-utils';\nimport JSZip from 'jszip';\n\n/**\n * Zip exporter\n */\nexport const ZipWriter: Writer = {\n  name: 'Zip Archive',\n  extensions: ['zip'],\n  category: 'archive',\n  mimeTypes: ['application/zip'],\n  // @ts-ignore\n  encode: encodeZipAsync\n};\n\nasync function encodeZipAsync(fileMap: any, options: any = {}) {\n  const jsZip = new JSZip();\n  // add files to the zip\n  for (const subFileName in fileMap) {\n    const subFileData = fileMap[subFileName];\n\n    // jszip supports both arraybuffer and string data (the main loaders.gl types)\n    // https://stuk.github.io/jszip/documentation/api_zipobject/async.html\n    jsZip.file(subFileName, subFileData, options);\n  }\n\n  // always generate the full zip as an arraybuffer\n  options = Object.assign({}, options, {\n    type: 'arraybuffer'\n  });\n  const {onUpdate = () => {}} = options;\n\n  return jsZip.generateAsync(options, onUpdate).catch((error) => {\n    options.log.error(`Unable to write zip archive: ${error}`);\n    throw error;\n  });\n}\n"],"mappings":"AACA,OAAOA,KAAK,MAAM,OAAO;AAKzB,OAAO,MAAMC,SAAiB,GAAG;EAC/BC,IAAI,EAAE,aAAa;EACnBC,UAAU,EAAE,CAAC,KAAK,CAAC;EACnBC,QAAQ,EAAE,SAAS;EACnBC,SAAS,EAAE,CAAC,iBAAiB,CAAC;EAE9BC,MAAM,EAAEC;AACV,CAAC;AAED,eAAeA,cAAcA,CAACC,OAAY,EAAqB;EAAA,IAAnBC,OAAY,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,CAAC,CAAC;EAC3D,MAAMG,KAAK,GAAG,IAAIb,KAAK,CAAC,CAAC;EAEzB,KAAK,MAAMc,WAAW,IAAIN,OAAO,EAAE;IACjC,MAAMO,WAAW,GAAGP,OAAO,CAACM,WAAW,CAAC;IAIxCD,KAAK,CAACG,IAAI,CAACF,WAAW,EAAEC,WAAW,EAAEN,OAAO,CAAC;EAC/C;EAGAA,OAAO,GAAGQ,MAAM,CAACC,MAAM,CAAC,CAAC,CAAC,EAAET,OAAO,EAAE;IACnCU,IAAI,EAAE;EACR,CAAC,CAAC;EACF,MAAM;IAACC,QAAQ,GAAGA,CAAA,KAAM,CAAC;EAAC,CAAC,GAAGX,OAAO;EAErC,OAAOI,KAAK,CAACQ,aAAa,CAACZ,OAAO,EAAEW,QAAQ,CAAC,CAACE,KAAK,CAAEC,KAAK,IAAK;IAC7Dd,OAAO,CAACe,GAAG,CAACD,KAAK,iCAAAE,MAAA,CAAiCF,KAAK,CAAE,CAAC;IAC1D,MAAMA,KAAK;EACb,CAAC,CAAC;AACJ"}