{"version":3,"file":"parse-i3s-building-scene-layer.js","names":["OBJECT_3D_LAYER_TYPE","parseBuildingSceneLayer","data","url","layer0","JSON","parse","TextDecoder","decode","sublayers","header","parseSublayersTree","layers","index","length","_subLayer$sublayers","subLayer","id","layerType","visibility","rest","sublayerUrl","concat","push"],"sources":["../../../../src/lib/parsers/parse-i3s-building-scene-layer.ts"],"sourcesContent":["import type {BuildingSceneLayerTileset, BuildingSceneSublayer} from '../../types';\n\nconst OBJECT_3D_LAYER_TYPE = '3DObject';\n\n/**\n * Parses Builiding Scene Layer and creates tileset\n * @param data\n * @param options\n * @param context\n */\nexport async function parseBuildingSceneLayer(\n  data: ArrayBuffer,\n  url: string\n): Promise<BuildingSceneLayerTileset> {\n  const layer0 = JSON.parse(new TextDecoder().decode(data));\n  const {sublayers} = layer0;\n\n  return {\n    header: layer0,\n    sublayers: parseSublayersTree(sublayers, url)\n  };\n}\n\n/**\n * Recursively parses Building Scene Layer sublayers.\n * @param sublayers\n * @param url\n */\nfunction parseSublayersTree(\n  sublayers: BuildingSceneSublayer[],\n  url: string\n): BuildingSceneSublayer[] {\n  let layers: BuildingSceneSublayer[] = [];\n\n  for (let index = 0; index < sublayers.length; index++) {\n    const subLayer = sublayers[index];\n    const {id, layerType, visibility = true, ...rest} = subLayer;\n\n    // Add support only for 3DObject layer type for I3S purposes.\n    if (layerType === OBJECT_3D_LAYER_TYPE) {\n      const sublayerUrl = `${url}/sublayers/${id}`;\n\n      layers.push({\n        url: sublayerUrl,\n        id,\n        layerType,\n        visibility,\n        ...rest\n      });\n    }\n\n    if (subLayer?.sublayers?.length) {\n      layers = [...layers, ...parseSublayersTree(subLayer.sublayers, url)];\n    }\n  }\n\n  return layers;\n}\n"],"mappings":"AAEA,MAAMA,oBAAoB,GAAG,UAAU;AAQvC,OAAO,eAAeC,uBAAuBA,CAC3CC,IAAiB,EACjBC,GAAW,EACyB;EACpC,MAAMC,MAAM,GAAGC,IAAI,CAACC,KAAK,CAAC,IAAIC,WAAW,CAAC,CAAC,CAACC,MAAM,CAACN,IAAI,CAAC,CAAC;EACzD,MAAM;IAACO;EAAS,CAAC,GAAGL,MAAM;EAE1B,OAAO;IACLM,MAAM,EAAEN,MAAM;IACdK,SAAS,EAAEE,kBAAkB,CAACF,SAAS,EAAEN,GAAG;EAC9C,CAAC;AACH;AAOA,SAASQ,kBAAkBA,CACzBF,SAAkC,EAClCN,GAAW,EACc;EACzB,IAAIS,MAA+B,GAAG,EAAE;EAExC,KAAK,IAAIC,KAAK,GAAG,CAAC,EAAEA,KAAK,GAAGJ,SAAS,CAACK,MAAM,EAAED,KAAK,EAAE,EAAE;IAAA,IAAAE,mBAAA;IACrD,MAAMC,QAAQ,GAAGP,SAAS,CAACI,KAAK,CAAC;IACjC,MAAM;MAACI,EAAE;MAAEC,SAAS;MAAEC,UAAU,GAAG,IAAI;MAAE,GAAGC;IAAI,CAAC,GAAGJ,QAAQ;IAG5D,IAAIE,SAAS,KAAKlB,oBAAoB,EAAE;MACtC,MAAMqB,WAAW,MAAAC,MAAA,CAAMnB,GAAG,iBAAAmB,MAAA,CAAcL,EAAE,CAAE;MAE5CL,MAAM,CAACW,IAAI,CAAC;QACVpB,GAAG,EAAEkB,WAAW;QAChBJ,EAAE;QACFC,SAAS;QACTC,UAAU;QACV,GAAGC;MACL,CAAC,CAAC;IACJ;IAEA,IAAIJ,QAAQ,aAARA,QAAQ,gBAAAD,mBAAA,GAARC,QAAQ,CAAEP,SAAS,cAAAM,mBAAA,eAAnBA,mBAAA,CAAqBD,MAAM,EAAE;MAC/BF,MAAM,GAAG,CAAC,GAAGA,MAAM,EAAE,GAAGD,kBAAkB,CAACK,QAAQ,CAACP,SAAS,EAAEN,GAAG,CAAC,CAAC;IACtE;EACF;EAEA,OAAOS,MAAM;AACf"}